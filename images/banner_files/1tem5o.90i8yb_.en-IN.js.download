(this.$WP=this.$WP||[]).push(["1tem5o",(e,a)=>{var t,r,n,i,o,s,l,d,c,u,h,m,g,p,f,T,v,E,b,I,y,C,N,_,S,M,R,k,P,A,w,O,L,D,B,Q,z,x,H,W,V,K,q,G,Y,j,U,F,Z,X,J,$,ee,ea,et,er,en,ei,eo,es,el,ed,ec,eu,eh,em,eg,ep,ef,eT,ev,eE,eb,eI,ey,eC,eN,e_,eS,eM,eR,ek,eP,eA,ew,eO,eL,eD,eB,eQ,ez,ex,eH,eW,eV,eK,eq,eG,eY,ej,eU,eF,eZ,eX,eJ,e$,e0,e1,e2,e4,e3,e6,e9,e7,e5,e8,ae,aa,at,ar,an,ai,ao,as,al,ad,ac,au,ah,am,ag,ap,af,aT,av,aE,ab,aI,ay,aC,aN,a_,aS,aM,aR,ak,aP,aA,aw,aO,aL,aD,aB,aQ,az,ax,aH,aW,aV,aK,aq,aG,aY,aj,aU,aF,aZ,aX,aJ,a$,a0,a1,a2,a4,a3,a6={toast:"sraSA _Q _U l Za",toastWrapper:"DSDjH"},a9=e=>{switch(e){case"error":return Y;case"success":return G;case"thumbsDown":return j;case"thumbsUp":return U}},a7=({children:e})=>{var[a,n]=i(null),l=!!a?.textContent;o(()=>{var e;return l&&(e=setTimeout(()=>n(null),a?.isDurationLong?6e3:3500)),()=>clearTimeout(e)},[l,a]);var d=s(()=>({openToast:e=>{n(e)}}),[]);return t(as.Provider,{value:d,children:[e,a?r("div",{className:a6.toast,role:"alert",children:r("div",{className:a6.toastWrapper,children:r(F,{variant:a.variant,textContent:a.textContent,icon:a9(a.icon)})})}):null]})},a5=()=>{var e=d(as);if(!e)throw Error("Please use the hook inside the ChatPanelsToastContext context provider");return e},a8={__key:28710699928632,id:"1a1cbb120c38cd2e",loc:{},definitions:[]},te={__key:96006977412143,id:"57515dc8dc2fede0",loc:{},definitions:[]},ta={__key:0xb78424f169b1,id:"b78424f169b142df",loc:{},definitions:[]},tt={__key:0x8786e16fbe96,id:"8786e16fbe962d09",loc:{},definitions:[]},tr={__key:26039558715119,id:"17aecea5b6efc6dc",loc:{},definitions:[]},tn={__key:2514373530611,id:"02496c5753f34af4",loc:{},definitions:[]},ti=e=>{var a=v.useConstantIncrementCallback(1),t=v.useIncrementCallback(au,E.M);return c(e=>{var r=0,n=!1;e.forEach(e=>{e?.content?.forEach(e=>{e?.__typename==="TravelChatManager_LocationList"&&(r+=e.locations.length),e?.__typename==="TravelChatManager_Text"&&e?.link?.anchorText&&(n=!0)})}),r>0?(t(r),a(au,E.LOCATIONSELECTION),a(au,E.TAG),a(au,E.LK),a(au,E.LOCALIZATION)):n&&a(au,E.LOCALIZATION)},[a,t,e])},to=({threadId:e,messageId:a,limit:t,mostRecentFirst:r=!1},n=!1)=>{var i=q()||"",l=ed(),d=s(()=>({userId:i,threadId:e,messageId:a,limit:t,currency:l,tagCategories:ac}),[i,e,a,t,l]),[{data:c,fetching:u,error:h},m]=eo({query:tr,variables:d,pause:n,requestPolicy:"network-only"}),g=ti("useMessages");return o(()=>{var e=c?.TravelChatManager_getMessages?.messages;!u&&!n&&e?.length&&g(e.map(e=>e?.__typename==="TravelChatManager_AssistantMessage"?e:null).filter(Boolean))},[c,u,d,n,g]),[{data:s(()=>{if(c){var e=c.TravelChatManager_getMessages?.messages||null;return{messages:!e||r?e:[...e].reverse(),nextMessageId:c?.TravelChatManager_getMessages?.nextMessageId||null}}},[c,r]),fetching:u,error:h},m]},ts=()=>{var e=q()||"",{languageTag:a,geoId:t,locationId:r,pageName:n,currency:i}=T(),[{fetching:o},s]=es(te),l=ti("useSendMessage");return{sendMessage:c(({threadId:o,text:d,response:c,userId:u})=>s({userId:u??e,threadId:o,responseContent:c,text:d,geoId:t,languageTag:a,locationId:r,pageName:n,localTime:new Date().toISOString(),currency:i,tagCategories:ac}).then(e=>{var a=e.data?.TravelChatManager_addMessage?.reply;return l(a?[a]:[]),e}),[s,e,t,a,r,n,i,l]),fetching:o}},tl=()=>{var e=q()||"",a=ed(),[{fetching:t,error:r},n]=es(ta);return{cancelPendingMessage:c(({threadId:t,messageId:r})=>n({userId:e,threadId:t,messageId:r,currency:a,tagCategories:ac}),[n,e,a]),fetching:t,error:r}},td=()=>{var e=q()||"",[{fetching:a},t]=es(a8);return{addFeedback:c(({threadId:a,messageId:r,rating:n,customFeedback:i})=>t({userId:e,threadId:a,messageId:r,rating:n,customFeedback:i}),[t,e]),fetching:a}},tc=({threadId:e,limit:a},t=!1)=>{var r=q()||"",n=s(()=>({userId:r,threadId:e,limit:a}),[r,e,a]);return eo({query:tn,variables:n,pause:t,requestPolicy:"network-only"})},tu=()=>{var e=q()||"",[a,t]=es(tt);return{deleteThreads:c(a=>t({userId:e,threadId:a}),[t,e]),state:a}},th=e=>{for(var a=e.slice(),t=a.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1));[a[t],a[r]]=[a[r],a[t]]}return a},tm={optionsContainer:"oNVYt Rd Gi",optionsHeader:"zVilR f MI",optionsHeaderContent:"P",thumbsContainer:"NM Nk",freeFormContainer:"yJRrg",freeFormSubmitContainer:"gOmiR f",votingThumbsContainer:"XlDrI f",votedThumbsContainer:"edJMz Ci"},tg=({disabled:e,onSubmit:a})=>{var[n,s]=i(""),l=u(null),d=u(null);return o(()=>{d.current?.scrollIntoView({behavior:"smooth",block:"end"}),l.current?.focus()},[]),t("form",{ref:d,onSubmit:e=>{e.preventDefault(),a(n.trim())},children:[r(eE,{value:n,onChange:e=>s(e.target.value),"aria-label":ad.feedback.inputAriaLabel,placeholder:ad.feedback.feedbackPlaceholder,maxLength:160,ref:l}),r("div",{className:tm.freeFormSubmitContainer,children:r($,{type:"submit",disabled:e,variant:"primary",children:ad.feedback.submitButton})})]})},tp=({feedbackRating:e,disabled:a,onSelect:n,onClose:i})=>{var l=u(null);o(()=>{l.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[]);var d=e=>{n({isFlowComplete:"OTHER"!==e,rating:e})},c="OTHER"===e,h=[...s(()=>th(Object.entries(ah).slice(0,4)),[]),...Object.entries(ah).slice(4)];return t("div",{className:tm.optionsContainer,ref:l,children:[t("div",{className:tm.optionsHeader,children:[r("div",{id:"feedbackOptionsLabel",className:tm.optionsHeaderContent,children:r(et,{atlasVariant:"fixed-label-30",children:ad.feedback.thumbsDownTitle})}),r(ee,{type:"button",variant:"clear",size:"small",icon:ef,onClick:i,"aria-label":ad.feedback.closeAriaLabel})]}),r(eT,{name:"feedbackOptions",ariaLabelledBy:"feedbackOptionsLabel",children:h.map(([t,n])=>r("div",{children:r(ev,{value:t,selected:e===t,onSelect:()=>d(t),label:n,disabled:a,alignItems:"center"},t)},t))}),c&&r("div",{className:tm.freeFormContainer,children:r(tg,{onSubmit:a=>{c&&n({isFlowComplete:!0,rating:e,message:a.trim()})},disabled:a})})]})},tf=({disabled:e,onThumbsUp:a,onThumbsDown:n,feedbackRating:i})=>i?r("div",{className:tm.votedThumbsContainer,children:"GOOD"===i?r(ep,{size:20,ariaAttributes:{"aria-label":ad.feedback.votedThumbsUpAriaLabel},"data-automation":"aitaThumbsUp"}):r(eg,{size:20,ariaAttributes:{"aria-label":ad.feedback.votedThumbsDownAriaLabel},"data-automation":"aitaThumbsDown"})}):t("div",{className:tm.votingThumbsContainer,children:[r(ee,{variant:"primary",icon:U,size:"small",onClick:e?void 0:a,"aria-label":ad.feedback.voteThumbsUpAriaLabel,dataAttributes:{"data-automation":"aitaThumbsUp"}}),r(ee,{variant:"primary",icon:j,size:"small",onClick:e?void 0:n,"aria-label":ad.feedback.voteThumbsDownAriaLabel,dataAttributes:{"data-automation":"aitaThumbsDown"}})]}),tT=({feedbackRating:e,onFeedback:a,isOnFeedbackFetching:n})=>{var[o,s]=i(e),[l,d]=i(!1),{openToast:c}=a5(),u=e=>c({textContent:ad.feedback["GOOD"===e?"thanksGood":"thanksBad"],variant:"primary",icon:"GOOD"===e?"thumbsUp":"thumbsDown",isDurationLong:!0}),h=e=>{if(!n){var t=e.rating;a(t,e.message).then(a=>{if(!a.ok){c({textContent:ad.feedback.error,variant:"error",icon:"error"});return}e.isFlowComplete&&u(t),t!==o&&s(t),d("GOOD"!==t&&!e.isFlowComplete)})}};return t("div",{children:[r("div",{className:tm.thumbsContainer,children:r(tf,{feedbackRating:o,disabled:n,onThumbsUp:()=>{h({rating:"GOOD",isFlowComplete:!0})},onThumbsDown:()=>{h({rating:"BAD",isFlowComplete:!1})}})}),l&&r(tp,{feedbackRating:o,disabled:n,onSelect:h,onClose:()=>{u("BAD"),d(!1)}})]})},tv=({feedbackRating:e,threadId:a,messageId:t})=>{var{addFeedback:n,fetching:i}=td(),o=W(),s=b();return r(am,{feedbackRating:e,onFeedback:async(e,r)=>{o({itemType:"aitaMessage",actionSubType:"rateMessage",threadId:a,messageId:t,feedbackRating:e});var i=await n({threadId:a,messageId:t,rating:e,customFeedback:r});return s({requestName:"addFeedback",error:i.error,hasData:!!i.data}),{ok:!i.error}},isOnFeedbackFetching:i})},tE={__key:0x6a2e91e745a9,id:"6a2e91e745a9d275",loc:{},definitions:[]},tb={__key:26084922600521,id:"17b95e8bac499cc5",loc:{},definitions:[]},tI="RpcvS Gi B1 Z BF Cj z Pk PY Pw PK f e",ty="wJnKA f",tC=({threadId:e,messageId:a,locationId:n,postId:i,userProfile:o,forumName:s,topicTitle:l,url:d,body:c,snippets:u})=>{var h={itemType:"aitaForumPostCard",threadId:e,messageId:a,locationId:n,itemId:`${i}`},m=V(h),g=W(),p=t("div",{className:ty,children:[r(et,{color:"onSurface",atlasVariant:"fixed-body-10",lineClamp:1,children:s}),t("span",{"aria-hidden":!0,children:[r(et,{color:"onSurface",atlasVariant:"fixed-body-10",elementType:"span",children:"•\xa0"}),r(eN,{size:14,color:"inherit"})]})]});return t("div",{ref:m,className:tI,...eS("aitaSourceCard"),children:[t("div",{className:"HIEXR f e",children:[r(e_,{variant:"two-line",profileInfo:[o],additionalInfo1:p}),r(et,{atlasVariant:"fixed-label-20",color:"onSurface",lineClamp:2,children:l}),r(et,{atlasVariant:"fixed-body-20",color:"onSurface",lineClamp:8,children:u.length?u[0]:c})]}),r(ea,{href:d,target:"_blank",onClick:()=>g({...h,actionSubType:"clickSeeFullForumPost"}),variant:"primary-small",...eS("aitaSeeFullForumPost"),children:ad.chat.seeFullForumPost})]})},tN=({threadId:e,messageId:a,locationId:n,reviewId:i,userProfile:o,publishedDate:s,rating:l,url:d,snippets:c})=>{var u={itemType:"aitaReviewCard",threadId:e,messageId:a,locationId:n,itemId:`${i}`},h=V(u),m=W(),g=ec(),p=`${g.formatDate("date_medium_month_year",s)}`,{contributionCount:f}=o,T=t("div",{className:ty,children:[r(et,{color:"onSurface",atlasVariant:"fixed-body-10",children:p}),r(et,{color:"onSurface",atlasVariant:"fixed-body-10",children:"•"}),r(et,{color:"onSurface",atlasVariant:"fixed-body-10",children:g.formatNumber("integer",f)}),r(eR,{size:14,ariaAttributes:{"aria-hidden":!0}})]});return t("div",{ref:h,className:tI,...eS("aitaSourceCard"),children:[t("div",{children:[r(e_,{variant:"two-line",profileInfo:[o],additionalInfo1:T}),r("div",{className:"Mk MI",children:r(eM,{showRating:!1,size:"small",rating:l})}),r("div",{children:r(et,{atlasVariant:"fixed-body-20",color:"onSurface",lineClamp:8,children:c.length&&c[0]})})]}),r(ea,{href:d,target:"_blank",onClick:()=>m({...u,actionSubType:"clickSeeFullReview"}),variant:"primary-small",...eS("aitaSeeFullReview"),children:r(el,{id:"gai_review_summary_see_full_reviews",messages:"See full review"})})]})},t_={sourceShelfContainer:"Zb Px",scrollableContainer:"_T",sourceShelfScrollable:"zfJeQ _e",sourceShelf:"udkmU f",loadingContainer:"JvoYC f j u e",hasForumPosts:"bzFhD"},tS=({threadId:e,messageId:a,locationId:n,reviewSnippets:s,forumPostSnippets:l})=>{var[d,c]=i(!1),h=u(null),m={itemType:"aitaSourcesCta",threadId:e,messageId:a,locationId:n},g=V(m),p=W();o(()=>{d&&h.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[d]),tM(d,s.size,l.size);var f=s.size+l.size,T=f>1?ad.chat.showSources:ad.chat.showSource;return d&&(T=f>1?ad.chat.hideSources:ad.chat.hideSource),t("div",{ref:g,children:[r(ea,{variant:"primary",onClick:()=>{c(!d),p({...m,actionSubType:d?"collapseSources":"expandSources"})},icon:d?eI:eb,trailing:!0,"aria-expanded":d,automationId:"aitaShowSources",children:r(et,{atlasVariant:"fixed-label-20",children:T})}),d&&r("div",{className:t_.sourceShelfContainer,style:{width:`${266*f-16}px`},ref:h,children:r(tw,{threadId:e,messageId:a,locationId:n,reviewSnippets:s,forumPostSnippets:l})})]})},tM=(e,a,t)=>{var[r,n]=i(!1),s=v.useConstantIncrementCallback(1),l=v.useConstantIncrementCallback(2),d=v.useConstantIncrementCallback(3);o(()=>{!r&&e&&(a&&(s(aT,E.UR),s(aT,E.G)),t&&s(aT,E.F2),(a||t)&&(s(aT,E.LK),s(aT,E.M),a?d(aT,E.MEM):l(aT,E.MEM)),n(!0))},[r,e,a,t,s,l,d])},tR=e=>{var{maxWidth:a,maxHeight:t,urlTemplate:r}=e?.photoSizeDynamic??{};return a&&t&&r?{maxWidth:a,maxHeight:t,urlTemplate:r}:void 0},tk=e=>{var a=Array.from(e.keys()),t=!a.length,[{data:r,fetching:n,error:i},o]=eo({query:tb,variables:{reviewIds:a},pause:t}),l=s(()=>(r?.reviews??[]).filter(Boolean).map(a=>{var{id:t,userProfile:r,publishedDate:n,rating:i,url:o}=a,s=n?new Date(n):null;return t&&r?.displayName&&r?.contributionCounts?.sumAllUgc!=null&&s&&!isNaN(s.valueOf())&&i&&o?{reviewId:t,userProfile:{displayName:r?.displayName,avatarSource:tR(r?.avatar),contributionCount:r?.contributionCounts?.sumAllUgc},publishedDate:s,rating:i,url:o,snippets:e.get(t)??[]}:null}).filter(Boolean),[r?.reviews,e]);return N({requestName:"getReviews",fetching:n,error:i,hasData:!!l.length,isQueryPaused:t}),{reviews:l,fetching:n,error:i,reexcuteReviewsQuery:()=>o({requestPolicy:"network-only"})}},tP=e=>{var a=Array.from(e.keys()),t=!a.length,[{data:r,fetching:n,error:i},o]=eo({query:tE,variables:{forumPostIds:a},pause:t}),l=s(()=>(r?.posts??[]).filter(Boolean).map(a=>{var{id:t,userProfile:r,forumName:n,topicTitle:i,body:o,url:s}=a;return t&&r?.displayName&&n&&i&&o&&s?{postId:t,userProfile:{displayName:r?.displayName,avatarSource:tR(r?.avatar)},forumName:n,topicTitle:i,body:o,url:s,snippets:e.get(t)??[]}:null}).filter(Boolean),[r?.posts,e]);return N({requestName:"getForumPosts",fetching:n,error:i,hasData:!!l.length,isQueryPaused:t}),{forumPosts:l,fetching:n,error:i,reexcuteForumsQuery:()=>o({requestPolicy:"network-only"})}},tA=(e,a)=>{var t="";return a?.networkError?t=" - network error":a?.graphQLErrors&&(t=" - gql errors"),`(ids: ${e.size?Array.from(e.keys()).join(", "):"none"}${t})`},tw=({threadId:e,messageId:a,reviewSnippets:n,forumPostSnippets:i,locationId:s})=>{var l="MOBILE"===z(),{scrollContainerProps:d,scrollButtonsProps:c}=I(10,!1,{itemWidth:(l?230:250)+16}),{reviews:h,fetching:m,error:g,reexcuteReviewsQuery:p}=tk(n),{forumPosts:f,fetching:T,error:v,reexcuteForumsQuery:E}=tP(i),b=m||T,N=u(null);o(()=>{b||N.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[b]);var _=!b&&!h.length&&!f.length;return(o(()=>{_&&console.error(`AITA: Failed to fetch reviews ${tA(n,g)} and/or forum posts ${tA(i,v)} for thread id ${e} and message id ${a}`)},[_,n,g,v,i,e,a]),b)?r("div",{className:Q(t_.loadingContainer,i.size&&t_.hasForumPosts),children:r(ey,{variant:"large"})}):_?r(y,{errorBody:ad.chat.sourcesErrorBody,retry:()=>{p(),E()},retryButtonTitle:ad.chat.sourcesErrorCta}):t("div",{ref:N,children:[r("div",{className:t_.scrollableContainer,children:t("div",{className:t_.sourceShelfScrollable,...d,children:[t("div",{className:t_.sourceShelf,children:[h.map(t=>{var{reviewId:n,userProfile:i,publishedDate:o,rating:l,url:d,snippets:c}=t;return r(af,{threadId:e,messageId:a,locationId:s,reviewId:n,userProfile:i,publishedDate:o,rating:l,url:d,snippets:c},`review-${n}`)}),f.map(t=>{var{postId:n,userProfile:i,forumName:o,topicTitle:l,body:d,url:c,snippets:u}=t;return r(ap,{threadId:e,messageId:a,locationId:s,postId:n,userProfile:i,forumName:o,topicTitle:l,body:d,url:c,snippets:u},`forum-post-${n}`)})]}),r(C,{...c,iconVariant:"chevron",showOnTablet:!0,shortShadows:!0,minimizeShadowBlur:!0})]})}),!!h.length&&r(eC,{marginTop:"spacing-02",tooltipVariant:"bottom-caret",includeHamonLawLocales:!0,openLinksInNewTab:!0})]})},tO=({threadId:e,messageId:a,locationId:t,sources:n})=>{var i=new Map,o=new Map;if(n.filter(Boolean).forEach(e=>{"TravelChatManager_ReviewList"===e.__typename?e.reviews.filter(Boolean).forEach(e=>{var{review_id:a,snippets:t}=e,r=t.filter(Boolean);r.length&&!i.has(a)&&i.set(a,r)}):"TravelChatManager_ForumList"===e.__typename&&e.posts.filter(Boolean).forEach(e=>{var{post_id:a,snippets:t}=e,r=t.filter(Boolean);o.has(a)||o.set(a,r)})}),i.size+o.size<1)return null;var s=new Map,l=new Map;for(var d of i.entries()){if(5===s.size)break;var[c,u]=d;s.set(c,u)}for(var h of o.entries()){if(s.size+l.size===5)break;var[m,g]=h;l.set(m,g)}return r(av,{threadId:e,messageId:a,locationId:t,reviewSnippets:s,forumPostSnippets:l})},tL=e=>{if(!e?.details)return!1;var{placeType:a,isGeo:t,locationId:r,name:n,route:i}=e.details;return!!a&&null!=t&&null!=r&&!!n&&!!i?.url},tD=(e,a)=>"COMPLETE"===e&&!a.link,tB=()=>c((e,a)=>tD(e,a),[]),tQ=e=>{var a=[];return e.forEach(e=>{if(e.responseData?.__typename==="TravelChatManager_AssistantMessage"){var t=e.responseData?.content?.find(e=>e?.__typename==="TravelChatManager_LocationList");t&&(a=[...a,...t.locations])}}),a.filter(e=>!!tL(e))},tz=e=>"ERROR"===e||"TIMEOUT"===e,tx=e=>{if(!e)return null;var a=e?.__typename==="TravelChatManager_AssistantMessage",t=!(a&&(e?.status==="COMPLETE"||e?.status==="PENDING"||e?.status==="CANCELED"));return{id:e?.messageId,sender:e?.__typename==="TravelChatManager_UserMessage"?"user":"agent",responseData:e,isCancel:a&&e?.status==="CANCELED",isError:t}},tH=({threshold:e,scrollAdjustment:a=10})=>{var t=u(null),[r,n]=i(!1),[o,s]=i(!1),l=eu(),d=c(a=>{var r=()=>{a&&(n(l?a.scrollLeft<=-e:a.scrollLeft>=e),s(a.scrollWidth>a.clientWidth+(l?-a.scrollLeft:a.scrollLeft)+e))};t.current&&t.current.removeEventListener("scroll",r),r(),a&&(a.addEventListener("scroll",r),t.current=a)},[e,l]),h=c(()=>{if(t.current){var e=t.current.children[0];if(e instanceof HTMLElement){var r=e.offsetWidth+a;t.current.scrollBy({left:l?-r:r,behavior:"smooth"})}}},[l,a]);return[d,c(()=>{if(t.current){var e=t.current.children[0];if(e instanceof HTMLElement){var r=e.offsetWidth+a;t.current.scrollBy({left:l?r:-r,behavior:"smooth"})}}},[l,a]),h,r,o]};function tW({location:e,lineClamp:a}){var t=ec(),{detail:n}=e,i=null,o=null;if(n?.__typename==="Hotel"&&(i=n.priceRange?.minimum??null,o=n.priceRange?.maximum??null),!i||!o)return null;var s=`${t.formatCurrencyInteger(i)} - ${t.formatCurrencyInteger(o)}`;return r(et,{display:"inline-block",atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(el,{id:"trips_hotel_price_dated",args:{price:r(et,{atlasVariant:"fixed-label-20",elementType:"span",color:"onSurface",children:s})},messages:"{price} per night"})})}var tV=e=>{switch(e){case"HOTEL":return 1;case"BB":return 2;case"OTHER":return 3;case"COLLAPSED_BB_INN":return 99;case"VR":return 6;default:return 0}};function tK({location:e,lineClamp:a}){var{popIndexRank:t,popIndexTotal:n}=e?.popIndexDetails??{};return e?.accommodationCategory&&t&&n?r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(eh,{id:"common_n_of_n_lodgingtype_in_geo_pl",args:{1:t,2:n,3:tV(e?.accommodationCategory),4:e?.geoName},messages:"#{1,number,integer} of {2,number,integer} {3, select, 1 {hotels} 2 {B&Bs / Inns} 3 {Specialty lodging} 6 {Vacation rentals} other {}} in {4}"})}):null}var tq=({location:e})=>{var a=e.locationV2?.names?.longOnlyHierarchyTypeaheadV2;return a?r(eK,{content:a,icon:eV}):null};function tG({lineClamp:e,tagsInfo:a}){var t=a?.reduce((e,a)=>a?.localizedName&&244===a.categoryId&&(e.push(a.localizedName),e.length>=2)?e.slice(0,2):e,[])?.join(", ");return t?r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:e,children:t}):null}function tY({location:e,lineClamp:a}){var{localize:t}=em(),n=ec(),{popIndexRank:i,popIndexTotal:o}=e.popIndexDetails||{};return i&&o&&e.geoName?r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,dataAttributes:{"data-automation":"flyout-attraction-ranking"},children:r(el,{id:"trips_v2_fly_out_ranking_4",args:{position:n.formatNumber("integer",i),total:n.formatNumber("integer",o),locationType:t.string("things to do","trips_v2_fly_out_ranking_things_to_do"),locationName:e.geoName},messages:"#{position} of {total} {locationType} in {locationName}"})}):null}function tj({link:e}){return e?t("div",{className:"f Q1",children:[r(eU,{size:16,color:"primaryIcon"}),r(en,{theme:"inline",href:e,target:"_blank",children:r(et,{elementType:"span",atlasVariant:"fixed-body-20",color:"inherit",children:r(el,{id:"restaurants_contact_links_menu",messages:"Menu"})})})]}):null}function tU({location:e,menu:a,lineClamp:i}){var o,{localize:s}=em(),l=s("Restaurant","common_Restaurant_3dd"),d=e.cuisines?.reduce((e,a)=>(a?.localizedName&&e.length<2&&e.push(a.localizedName),e),[])||[],c=e.price?.[0]?.localizedName??null,u=c?d.concat(c):d;return a?.menuUrl?o=a.menuUrl:a?.hasProvider&&e.route?.url&&(o=`${e.route.url}#menu`),t("div",{className:eG("_W K Q1",eY({lineClamp:i})),children:[t(et,{elementType:"span",atlasVariant:"fixed-body-20",color:"onSurfaceVariant",display:"flex",children:[r(eq,{size:16,marginRight:"spacing-01"}),l]}),u.length>0?" • ":null,u.map((e,a)=>t(et,{elementType:"span",atlasVariant:"fixed-body-20",color:"onSurfaceVariant",children:[e,a<u.length-1?" • ":""]},e)),o?t(n,{children:[" • ",r(tj,{link:o})]}):null]})}function tF({lineClamp:e,tagsInfo:a}){var t=eF(a?.map(e=>e?.tagId).filter(Boolean)??[]),n=a?.find(e=>e?.tagId===t),i=n?.localizedName||a?.[0]?.localizedName;return i?r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:e,children:i}):null}function tZ({location:e,lineClamp:a}){var t=ec(),n=e.locationV2?.details,i=n?.__typename==="LocationSelection_AttractionProductDetails"?{price:n?.productDetails?.pricingInfo?.fromPrice??null,isTieredPricing:n?.productDetails?.pricingInfo?.isTieredPricing??!1,isPerGroupPricing:n?.productDetails?.pricingInfo?.pricingType==="UNIT",flexibleDisplayDuration:n?.productDetails?.displayDuration?.__typename==="ExpPresentationService_FlexibleDisplayDuration"?n?.productDetails?.displayDuration:null}:null;return i?.price?r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(eZ,{price:r(et,{atlasVariant:"fixed-label-20",display:"inline-block",elementType:"span",color:"onSurface",children:t.formatCurrency(i.price)}),isTieredPricing:i.isTieredPricing,isPerGroupPricing:i.isPerGroupPricing})}):null}var tX=({location:e,tagsInfo:a})=>{if(e.isGeo)return r(ab,{location:e});var t=e.locationV2?.tags?.tags?.find(e=>e?.tagId===11066);switch(e.placeType){case"ACCOMMODATION":return r(tJ,{location:e});case"EATERY":return r(t$,{location:e});case"ACTIVITY":return r(t0,{location:e,tagsInfo:a});case"ATTRACTION":if(t)return r(t2,{location:e,tagsInfo:a});return r(t1,{tagsInfo:a});default:return null}},tJ=({location:e})=>t(n,{children:[r(tK,{location:e,lineClamp:1}),r(tW,{location:e,lineClamp:1})]}),t$=({location:e})=>r(tU,{location:e,lineClamp:1}),t0=({location:e,tagsInfo:a})=>t(n,{children:[r(tF,{lineClamp:1,tagsInfo:a}),r(tZ,{location:e,lineClamp:1})]}),t1=({tagsInfo:e})=>r(tG,{lineClamp:1,tagsInfo:e}),t2=({location:e,tagsInfo:a})=>t(n,{children:[r(tG,{lineClamp:1,tagsInfo:a}),r(tY,{location:e,lineClamp:1})]}),t4={container:"WiXwJ z I W _X",card:"IdRsz Cj Gi Re o",imageContainer:"YdkBi I",info:"kKjNx e Q1"},t3={buttonsContainer:"DJYdd u f k l _Q w",filler:"f H",previousButton:"iTdnw NL",nextButton:"vswka Nj"},t6=({scrollBack:e,scrollForward:a})=>{var{localize:n}=em();return t("div",{className:t3.buttonsContainer,children:[e&&r("div",{className:t3.previousButton,children:r(ee,{"aria-label":n.string("Previous","common_Previous"),variant:"primary-border",icon:eX,onClick:e,automationId:"aitaMapCarouselPrevious"})}),r("div",{className:t3.filler}),a&&r("div",{className:t3.nextButton,children:r(ee,{"aria-label":n.string("Next","common_Next"),variant:"primary-border",icon:eJ,onClick:a,automationId:"aitaMapCarouselNext"})})]})},t9=({threadId:e,messageId:a,locations:i,listElementsRef:o,listContainerRef:s,onCardChange:l,tagsInfoMap:d})=>{var{selectMarker:h}=eL(),m=u(null),g=u(!1),[p,f,T,v,E]=aE({threshold:100}),b=e=>{if(!e)return!1;var a=e.getBoundingClientRect(),t=s.current?.getBoundingClientRect();return a.left>=(t?.left??0)&&a.right<=(t?.right??0)},I=c((e,a)=>{a&&l?.(e),h?.(e)},[h,l]),y=u(ez(()=>{var e=(m.current?.scrollLeft??0)>100,a=g.current||e;for(var[t,r]of o.current??new Map)if(b(r)){I(String(t),a),g.current=!0;break}},30));return t(n,{children:[r("div",{className:"EsGyW Q2 _t q",ref:e=>{m.current=e,p(e)},onScroll:y.current,"data-automation":"aita_map_item_carousel",children:i.map((t,n)=>r(ay,{index:n,threadId:e,messageId:a,ref:e=>{o&&"function"!=typeof o&&t?.details?.locationId&&(e?o.current?.set(String(t?.details?.locationId),e):o.current?.delete(String(t?.details?.locationId)))},location:t?.details||null,locationReviewSummary:t?.reviewRatingAndCount||null,tagsInfo:d&&t?.details?.locationId?d.get(t.details.locationId):void 0},t?.details?.locationId))}),r("div",{className:"JqoPO u S t w _Z",children:r(aC,{scrollBack:v?f:void 0,scrollForward:E?T:void 0})})]})},t7={__key:56623040765752,id:"337f943b1f38a391",loc:{},definitions:[]},t5=e=>{var a=[];return(e.forEach(e=>{var t=e?.details||null;null!==t&&null!==t.latitude&&null!==t.longitude&&a.push(new eA(t.latitude,t.longitude))}),a.length)?ew.fromArray(a):null},t8=e=>{if(e.tags?.find(e=>e?.tagId===11066))return e2;switch(e.placeType){case"ATTRACTION":return e0;case"EATERY":return e4;case"ACCOMMODATION":return e1;default:return eV}},re=e=>"BOTB"===e?"best-of-the-best":"default",ra=({location:e,selected:a,onClick:t,onMouseEnter:n,onMouseLeave:i})=>{var o,l=s(()=>new eA(e.latitude,e.longitude),[e]),[{data:d}]=e$({query:t7,variables:{saveObjects:[{id:e.locationId?.toString(),type:"location"}]},requestPolicy:"network-only",pause:!e.locationId},{Trips_addItemReferences:()=>"invalidateAndRefetch",tripsRemoveReference:()=>"invalidateAndRefetch",Trips_createTrip:()=>"invalidateAndRefetch"}),u=c(()=>{t?.(e.locationId)},[t,e.locationId]),h=c(()=>{n?.(e.locationId)},[n,e.locationId]),m=c(()=>{i?.(e.locationId)},[i,e.locationId]);e.isGeo||(o=e.reviewSummary?.rating??void 0);var g=!!d?.Trips_isSaved?.[0];return r(eD,{markerId:`${e.locationId}`,position:l,icon:t8(e),isSaved:g,rating:o,travelersChoice:e.awardType?{variant:re(e.awardType)}:void 0,onMouseEnter:h,onMouseLeave:m,onClick:u,markerAutomation:{automationId:a?"aitaTripMapMarkerSelected":"aitaTripMapMarker"},iconAutomation:{automationId:g?"aitaSavedPinIcon":void 0}})},rt={container:"GJQvE w _Z MJ Re o z",loadingOverlay:"DHARJ w _Z",carouselContainer:"DPaIe w Z1",zoomControl:"MsHgE"},rr=({threadId:e,messageId:a,locations:n,loading:l,onZoomChange:d,onPinClick:h,wrapperRef:m,onPanStart:g,tagsInfoMap:p,onMapNotSupported:f})=>{var T=W(),v="MOBILE"===z(),{selectMarker:E,selectedMarkerId:b}=eL(),I=u(new Map),y=u(null),[C,N]=i(null),[_,S]=i(!0),M=e=>{e&&I.current.get(e)?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},R=c(t=>{S(!1),E?.(String(t)),h?.(t),t&&(M(String(t)),T({itemType:"aitaMap",actionType:"click",actionSubType:"mapLocationIconClicked",threadId:e,messageId:a,itemId:String(t)}))},[h,E,T,e,a]),k=c(e=>{!l&&e.userGesture&&d?.(e)},[l,d]),P=s(()=>n.find(e=>String(e?.details?.locationId)===b),[n,b]);o(()=>{if(C&&b&&P&&P?.details?.latitude&&P?.details?.longitude&&!_){var e=C.getBounds(),a=new eA(P.details.latitude,P.details.longitude),t=eO.getPaddedBounds(a,C.getZoom(),aS),r=!e.containsPoint(a),n=t&&!e.containsBounds(t);(r||n)&&C.panIntoView(a,aS)}},[C,b,P,_]);var A=s(()=>n.map(e=>e?.details?.locationId&&e.details.latitude&&e.details.longitude?{locationId:e.details.locationId,isGeo:e.details.isGeo,placeType:e.details.placeType,latitude:e.details.latitude,longitude:e.details.longitude,name:e.details.name,reviewSummary:e.reviewRatingAndCount?.responseData?{count:e.reviewRatingAndCount.responseData.count,rating:e.reviewRatingAndCount.responseData.rating}:null,awardType:e.details.locationV2?.bestAwardForActiveYearV2?.awardType,tags:e.details.locationV2?.tags?.tags}:null).filter(Boolean),[n]),w=s(()=>n.length>0?t5(n):null,[n]);return t("div",{ref:m,className:rt.container,"data-automation":"aita_map_item_map",children:[t(eQ,{boundsPadding:aS,onClick:()=>{E?.(null)},onZoomChange:k,onPanStart:g,onRenderComplete:e=>{var a=e.map,t=a.getZoom(),r=a.getMinZoom();a.setMinZoom(Math.max(t-3,r)),N(e.map);var n=A[0]?.locationId;n&&E?.(String(n))},onMapNotSupported:f,cooperativeGestures:!0,initialBounds:w,children:[!v&&!l&&r("div",{className:rt.zoomControl,children:r(eP,{variant:"Square",zoomInAutomationId:"aitaMapZoomIn",zoomOutAutomationId:"aitaMapZoomOut"})}),A.map(e=>r(a_,{selected:b===String(e.locationId),location:e,onClick:R},e.locationId)),b&&r("div",{className:rt.carouselContainer,ref:y,children:r(aN,{threadId:e,messageId:a,locations:n,listElementsRef:I,listContainerRef:y,onCardChange:t=>{_&&S(!1);var r=n.findIndex(e=>`${e?.details?.locationId}`===t);t&&r>=0&&T({itemType:"aitaMap",actionType:"click",actionSubType:"mapScrollClick",threadId:e,messageId:a,itemId:t,mapScrollDepth:r+1})},tagsInfoMap:p})})]}),l&&r("div",{className:rt.loadingOverlay})]})},rn=e=>r(eB,{children:r(rr,{...e})}),ri={__key:0xf402a892aaed,id:"f402a892aaed3e02",loc:{},definitions:[]};function ro({location:e,lineClamp:a}){var[{fetching:t,data:n}]=eo({query:ri,variables:{locationId:e.locationId||0},pause:!e.locationId});if(t)return r(e6,{width:"100%",height:"17px"});var i=n?.attraction?.[0]?.details?.recommendedVisit;return i?r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(el,{id:"trips_cards_icon_content_duration",args:{sDuration:i},messages:"Duration: {sDuration}"})}):null}function rs({location:e,menu:a,tagsInfo:t}){if(!e.placeType)return null;var n=e.locationV2?.tags?.tags?.find(e=>e?.tagId===11066);switch(e.placeType){case"ACCOMMODATION":return r(rl,{location:e});case"EATERY":return r(rd,{location:e,menu:a});case"ACTIVITY":return r(rc,{location:e,tagsInfo:t});case"ATTRACTION":if(n)return r(rh,{location:e,tagsInfo:t});return r(ru,{location:e,tagsInfo:t});default:return null}}function rl({location:e}){return t(n,{children:[r(tK,{location:e}),r(tW,{location:e})]})}function rd({location:e,menu:a}){return r(tU,{location:e,menu:a})}function rc({location:e,tagsInfo:a}){return t(n,{children:[r(tF,{tagsInfo:a}),r(tZ,{location:e})]})}function ru({location:e,tagsInfo:a}){return t(n,{children:[r(tG,{tagsInfo:a}),r(ro,{location:e})]})}function rh({location:e,tagsInfo:a}){return t(n,{children:[r(tG,{tagsInfo:a}),r(tY,{location:e})]})}var rm={card:"sNRSm Fi",stack:"JsBMk",columns:"cTOwe Fi k",saveButton:"I"};function rg({location:e,menu:a,locationReviewSummary:i,onSaveClick:o,onSaveComplete:s,onNameLinkClick:l,tagsInfo:d}){var c,u=z(),h="MOBILE"===u,m="DESKTOP"===u,g=null;e.isGeo?g=r(ab,{location:e}):i?.responseData?.rating!=null&&i?.responseData?.count!=null&&(c={rating:i.responseData.rating,reviewCount:i.responseData.count});var p=r(et,{lineClamp:2,atlasVariant:"fixed-label-30",dataAttributes:{"data-automation":"aitaRecommendationTitle"},color:"onSurface",children:e.name}),f=e.route?.url?r(en,{href:e.route?.url,theme:"standalone",target:"_blank",onClick:l,children:p}):p,T=h?t("div",{className:rm.stack,children:[t("div",{className:rm.columns,children:[t("div",{className:rm.stack,children:[f,g,c?r(eM,{size:"small",showRating:!1,rating:c.rating,reviewCount:c.reviewCount}):null]}),r("div",{className:rm.saveButton,children:r(ei,{id:e.locationId,asButton:!h,roundedBackground:!h,variant:"primary-border",bookmarkStyle:"circular-button",renderLabel:h?void 0:e=>e,saveSourceOrigin:"AI_TRAVEL_ASSISTANT",onClick:o,onSaveComplete:s})})]}),r(rs,{location:e,menu:a,tagsInfo:d})]}):t(n,{children:[t("div",{className:rm.stack,children:[f,g,c?r(eM,{size:"small",showRating:!1,rating:c.rating,reviewCount:c.reviewCount}):null,r(rs,{location:e,menu:a,tagsInfo:d})]}),r("div",{className:rm.saveButton,children:r(ei,{id:e.locationId,asButton:m,roundedBackground:m,variant:"primary-border",bookmarkStyle:"circular-button",renderLabel:m?e=>e:void 0,saveSourceOrigin:"AI_TRAVEL_ASSISTANT",onClick:o,onSaveComplete:s})})]});return t("div",{className:rm.card,children:[r(ex,{source:e.thumbnail?.photoSizeDynamic,width:70,height:70,roundingSize:"medium"}),T]})}var rp=({location:e,menu:a,locationReviewSummary:t,threadId:n,messageId:i,tagsInfo:o})=>{var s=q(),{locationId:l}=e,d={itemType:"aitaLocationCard",threadId:n,messageId:i,itemId:`${l}`,isBookableAttractionProduct:e.locationV2?.details?.__typename==="LocationSelection_AttractionProductDetails"&&e.locationV2?.details?.productDetails?.pricingInfo!=null,viewType:"LIST"},c=V({...d,saveable:!0}),u=W(),h=function(e){switch(e){case"ATTRACTION":case"ACTIVITY":return"Attraction";case"EATERY":return"Restaurant";case"ACCOMMODATION":return"Hotel";default:return e}}(e.placeType);return r("div",{ref:c,className:"_T Gi","data-automation":h?`recommendationItem_${h}`:void 0,children:r(rg,{location:e,menu:a,locationReviewSummary:t,tagsInfo:o,onSaveClick:()=>u({...d,actionSubType:"clickSaveButton"}),onSaveComplete:(e,a,t)=>{u({...d,actionSubType:"saveLocationToTrip",tripId:t,tripSaveType:a}),_(s)},onNameLinkClick:()=>u({...d,actionSubType:"openLocationDetails"})})})},rf=({locations:e,threadId:a,messageId:i})=>{var o=e.map(({menu:e,details:o,reviewRatingAndCount:s,sources:l,tagsInfo:d})=>{var{locationId:c}=o,u=tO({threadId:a,messageId:i,locationId:c,sources:l});return t("li",{className:Q("iBMiJ Gi Re MJ",{CuIal:!u}),children:[r(aR,{threadId:a,messageId:i,location:o,menu:e,locationReviewSummary:s,tagsInfo:d}),u?t(n,{children:[r(e3,{marginTop:"spacing-03"}),u]}):null]},c)}).filter(Boolean);return r("ul",{children:o})},rT={tabs:"Xb MJ NB"},rv=({locationList:e,threadId:a,messageId:o,mapViewEnabled:l,tagsInfoMap:d})=>{var[c,u]=i(!0),h=W(),m=V({itemType:"aitaMap",threadId:a,messageId:o}),g=e.filter(e=>!!tL(e)).map(e=>{var{placeType:a,isGeo:t,locationId:r,name:n,route:i}=e.details,o=e.reviewRatingAndCount?.responseData?.count!=null&&null!=e.reviewRatingAndCount.responseData.rating&&e.reviewRatingAndCount.responseData.rating>=0;return{details:{...e.details,placeType:a,isGeo:t,locationId:r,name:n,route:{url:i.url}},menu:e.menu??void 0,reviewRatingAndCount:o?e.reviewRatingAndCount:null,sources:e.sources,tagsInfo:d?.size?d?.get(Number(r)):void 0}}),p=s(()=>[{state:"map",label:ad.chat.map,dataAutomation:"aitaMapRecommendationsSwitch"},{state:"list",label:ad.chat.list,dataAutomation:"aitaListRecommendationsSwitch"}],[]),[f,T]=i(p[0].state),v=s(()=>0!==g.filter(e=>e.details?.latitude!==null&&e.details?.longitude!==null).length,[g]);if(!g.length)return null;if(c&&l&&v){var E=f===p[0].state?r(S,{component:"chat_map",children:r(aM,{wrapperRef:m,threadId:a,messageId:o,locations:e,tagsInfoMap:d,onMapNotSupported:()=>{u(!1)}})}):r(ak,{locations:g,threadId:a,messageId:o});return t(n,{children:[r("div",{className:rT.tabs,children:r(ek,{bordered:!0,states:p,onStateChange:e=>{T(e),h({itemType:"aitaMap",actionType:"click",actionSubType:"mapListToggle",toggleType:"map"===e?"MAP":"LIST",threadId:a,messageId:o})},activeState:f})}),E]})}return r(ak,{locations:g,threadId:a,messageId:o})},rE="egcLq",rb="ORLqq",rI=({children:e})=>r(et,{atlasVariant:"fixed-body-30",dataAttributes:{"data-automation":"aitaNarrationItem"},children:e}),ry=()=>r(rI,{children:r("span",{role:"alert",children:ad.chat.canceledMessage})}),rC=()=>ad.chat.errorMessages[Math.floor(Math.random()*ad.chat.errorMessages.length)],rN=()=>{var e=s(()=>rC(),[]);return r(rI,{children:r("span",{role:"alert",children:e})})},r_=e=>{var a=/(?:\n|\r|\n\r|^) *$/u;return e.replace(/- /gmu,(e,t,r)=>r.substring(0,t).match(a)?e:"\\- ")},rS=({threadId:e,messageId:a,markdownText:t})=>r(er,{overrides:{p:{props:{className:"WRgTA"}},li:{props:{className:"QKKjg NM"}},ul:{props:{className:rE}},ol:{props:{className:rE}},hr:{props:{className:rE}},a:{component:({href:t,children:n})=>t?r(rM,{href:t,threadId:e,messageId:a,children:n}):r("span",{children:n})},h1:{component:({children:e})=>r(et,{elementType:"h1",atlasVariant:"fixed-title-10",color:"inherit",marginY:"spacing-01",children:e})},h2:{component:({children:e})=>r(et,{elementType:"h2",atlasVariant:"fixed-label-30",color:"inherit",marginY:"spacing-01",children:e})},h3:{component:({children:e})=>r("h4",{className:rb,children:e})},h4:{component:({children:e})=>r("h5",{className:rb,children:e})},h5:{component:({children:e})=>r("h6",{className:rb,children:e})}},children:r_(t)}),rM=({variant:e="inline",threadId:a,messageId:t,href:n,trackedUrl:i,children:o})=>{var s={itemType:"aitaLink",threadId:a,messageId:t,itemId:i??n,linkType:"buttonBorderless"===e?"cta":"inline"},l=V(s),d=W();return"buttonBorderless"===e?r(ea,{ref:l,href:n,target:"_blank",onClick:()=>d({...s,actionSubType:"openLink"}),dataAttributes:{"data-automation":"aitaChatResponseLink"},children:o}):r(en,{ref:l,theme:"inline",href:n,target:"_blank",onClick:()=>d({...s,actionSubType:"openLink"}),"data-automation":"aitaChatResponseLink",children:o})},rR=({threadId:e,messageId:a,impression:t,markdown:n})=>r("div",{ref:V({...t,saveable:t.saveable}),children:r(rI,{children:r(rS,{threadId:e,messageId:a,markdownText:n})})}),rk=({id:e,markdown:a,geoId:t,baseTrackingEvent:n})=>{var i=q(),o=W();return r(ei,{id:e,type:"aiassistantmessage",messageMarkdownBody:a,saveSourceOrigin:"AI_TRAVEL_ASSISTANT",predefinedLocationId:t,onClick:()=>o({...n,actionSubType:"clickTextBlockSaveButton"}),onSaveComplete:(e,a,t)=>{o({...n,actionSubType:"saveTextBlockToTrip",tripId:t,tripSaveType:a}),_(i)}})},rP=({threadId:e,messageId:a,status:n,content:i,resolvedGeoIds:o,feedbackRating:s,isMapViewEnabled:l,tagsInfoMap:d})=>{var c={sender:"agent",id:a};if("CANCELED"===n)return{...c,isPending:!1,contents:[{type:"text",content:r(ry,{})}]};if(tz(n))return{...c,isPending:!1,contents:[{type:"text",content:r(rN,{}),backgroundColor:"red"}]};var u=o?.length===1?o[0]:null,h=[];return(i??[]).forEach((o,s)=>{if(o){var c=o.__typename,m=`${a}-${s}`;switch(c){case"TravelChatManager_Text":if(i){var g=tO({threadId:e,messageId:a,sources:o.sources}),p=rA(o.link,a,e),f={itemType:"aitaTextBlock",threadId:e,messageId:a,itemId:m},T=o.content,v=tD(n,o)?r(rk,{id:m,markdown:T,geoId:u,baseTrackingEvent:f}):void 0;h.push({saveButton:v,type:"text",content:t("div",{role:"alert",children:[r(rR,{threadId:e,messageId:a,impression:{...f,saveable:!!v},markdown:T}),p,g]})})}return;case"TravelChatManager_LocationList":h.push({backgroundColor:"transparent",type:"list",content:r(aP,{threadId:e,messageId:a,locationList:o.locations,mapViewEnabled:l,tagsInfoMap:d})});return;default:console.error(`Unhandled chat message content type: ${c}`)}}}),("COMPLETE"===n||"INAPPROPRIATE_PROMPT"===n)&&h.length&&(h[h.length-1].footer=r(ag,{threadId:e,messageId:a,feedbackRating:s??void 0})),{...c,isPending:"PENDING"===n,contents:h}},rA=(e,a,t)=>{var n=e?.route?.webLinkUrl,i=e?.route?.url??void 0,o=e?.anchorText?.value;return e&&n&&o?r(rM,{variant:"buttonBorderless",href:n,trackedUrl:i,messageId:a,threadId:t,children:o}):null},rw="data-message-id",rO=({containerElement:e,assistantMessageId:a,userMessageId:t})=>{var r=(e?.scrollTop??0)+(e?.getBoundingClientRect()?.height??0),n=(e?.scrollHeight??0)-r;return!e||n>60?null:()=>{var r=t?e.querySelector(`[${rw}="${t}"]`):void 0,n=e.querySelector(`[${rw}="${a}"]`);if(n){var i=e.getBoundingClientRect().y;if(!r){var o=n.getBoundingClientRect().y-i-72;if(o<10)return;e.scrollBy({top:o,behavior:"smooth"});return}var s=r.getBoundingClientRect().y-i-72;s<0||s>e.getBoundingClientRect().height||e.scrollBy({top:s,behavior:"smooth"})}}},rL=({containerElement:e,assistantMessageId:a,userMessageId:t})=>{var r=rO({containerElement:e,assistantMessageId:a,userMessageId:t});r&&setTimeout(r,5)},rD={yes:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfOAjyrsIbEtkNHprpWsMGKXVUA36dlwbwvp72Z5MyaHWw==",no:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPeE63jtwgJHhDoCL+Frrrn"},rB=e=>e.replace(/^#{1,6}\s?/gmu,"").replace(RegExp("(?:\\*\\*|__)(?<boldText>.*?)\\1","gu"),"$<boldText>").replace(RegExp("(?:\\*|_)(?<italicText>.*?)\\1","gu"),"$<italicText>").replace(/\n{2,}/gu,"\n").replace(RegExp("\\[(?<linkText>[^\\]]+)\\]\\([^)]+\\)","gu"),"$<linkText>").trim(),rQ=e=>e?.some(e=>e?.__typename==="TravelChatManager_LocationList"&&e.locations.some(e=>!e?.details?.isGeo))?"RECOMMENDATIONS":e?.some(e=>e?.__typename==="TravelChatManager_Text"&&(e.link||e.content.match(/\[[^\]]+\]\([^)]+\)/u)))?"TEXT_WITH_LINK":"TEXT_ONLY",rz=e=>{var a=W(),t=aw.useConstantIncrementCallback(1),r=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2mvXC1F1QD1GAQ/Ftk3D3TA=="),n=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2e0NTaHthS2OXssxKll5TzQ=="),i=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ErxijeWU05OEv3RbyJAjq/jsfto8jASOk79+ZWECu3Q="),o=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2jPA2HCMlQO4iMsQnWJsppU+Q+LqZZ8ZlPLI7SPLeTp4="),l=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2C8w6YwozyLN+aqlWTRTWkX6pA4b4zODuYL/AURXsmuU="),d=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ant5d7sB0ZbWI5b6tWQzjlKPVeBEGE0fAIjRYYWsU/Y="),u=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2KoreqLBSPNumuAk6b0SAnq/0coHBIy8Ky4FFPHott5k="),h=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2SY/UpGjfIFzRF7h1B6Dsew=="),m=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ifQyq41qiG+v6tgn+Znxi9dbcJM+4aYNLzD0DLM1N7c="),g=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2yIbEkrXdo88ME3fnfuCpE0rbKeuSVbHGD5Dvr2kx+H4="),p=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2PTCJYqbxmE/1tw8yYOlMVPxkWYdpewW+bHVzSqZQpIo="),f=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2dEO1vlbbi7o00nG/wrtoalPid4TPt1fydBZsD1kBHdo="),T=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2qohvUUh1SJVxHoLzmh+Stp3PeHIalM9icFKbX+Vo/sg="),v=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2QfE9UFK8Pe00xpa/tkofs78n8Qxcg8tUcE8+mxAmVjs="),E=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2kZKRR5p/OVVlahfTe6QDJvF3cuyrJiKxIsnAv6X+/vg="),b=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2TZU3VFp7Zb843+Af7rfAfg=="),I=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ruXb3HAYaiiPXEU8ZJEQ7LTe2csLjDSYmFZI1b2oHIc="),y=aO.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2XBvgBA0JMp9tr5M4K3TdG/OtV/t4HEXRZim2AIa5txs="),C=s(()=>({CANCELED:r,COMPLETE:n,INAPPROPRIATE_PROMPT:i,SEND_NETWORK_ERROR:o,SEND_INVALID_RESPONSE:l,SEND_EMPTY_RESPONSE:d,SEND_GRAPHQL_ERROR:u,SEND_TIMEOUT:h,SEND_SERVER_ERROR:m,SEND_SERVER_TIMEOUT:g,ANOTHER_PROMPT_PENDING:p,POLL_NETWORK_ERROR:f,POLL_INVALID_RESPONSE:T,POLL_EMPTY_RESPONSE:v,POLL_GRAPHQL_ERROR:E,POLL_TIMEOUT:b,POLL_SERVER_ERROR:I,POLL_SERVER_TIMEOUT:y}),[p,r,n,i,v,E,T,f,I,y,b,d,u,l,o,m,g,h]),N=tB();return c(({threadId:r,messageId:n,status:i,message:o,error:s})=>{var l=o?.some(e=>e?.__typename==="TravelChatManager_Text"&&N(i,e)||e?.__typename==="TravelChatManager_LocationList"&&e.locations.some(e=>tL(e))),d=o?o.reduce((e,a)=>a?.__typename==="TravelChatManager_Text"?e+rB(a.content).length:e,0):0,c=e.current?Date.now()-e.current:void 0;a({itemType:"aitaMessagesPanel",actionType:"other",actionSubType:"settleAssistantMessage",threadId:r,messageId:n,messageStatus:i,messageLatency:c,textLength:d,messageError:s,saveable:l,responseType:o?rQ(o):void 0});var u="ERROR"===i?s:i;t(aL[u],void 0===c?rD.no:rD.yes),void 0!==c&&C[u](c)},[a,t,C,e,N])},rx="TMP-ID-1-1",rH=()=>`TMP-ID-${Math.random()}-${Math.random()}`,rW=e=>e[e.length-1]?.isPending?e[e.length-1].id:void 0,rV=(e,a)=>({sender:"agent",isError:!0,isPending:!1,id:e,refetch:a}),rK=({initialThreadId:e})=>{var a=W(),t=b(),r=u(null),[n,s]=i(e),[l,d]=i(e?[]:[aB]),[h,m]=i(e?[]:[aB]),[g,p]=i(null),f=u(null),T=u(null),v=aD(T),[E,I]=i({messageId:null,pauseQuery:!0}),{sendMessage:y,fetching:C}=ts(),{cancelPendingMessage:_,fetching:S,error:M}=tl(),R=!e,[{data:k,fetching:P,error:A},w]=to({threadId:e??"",limit:10},R);N({requestName:"getMessages",fetching:P,error:A,hasData:!!k,isQueryPaused:R});var O=!e||E.pauseQuery||!E.messageId,[L,D]=to({threadId:e??"",limit:5,messageId:E.messageId??void 0},O);N({requestName:"getMessages",fetching:L.fetching,error:L.error,hasData:!!L.data,isQueryPaused:O});var B=u(0),Q=!n||!g?.assistantMessageId,[{data:z,fetching:x,error:H},V]=to({threadId:n??"",limit:1,messageId:g?.assistantMessageId??""},Q);N({requestName:"getMessages",fetching:x,error:H,hasData:!!z,isQueryPaused:Q});var K=c((e,i={})=>{if(!f.current){B.current=0;var o=rH();f.current=o,p(null),T.current=Date.now();var{text:l,type:c,origin:u,promptType:h,promptScrollDepth:g}=e,E=rH();d(e=>[...e,{sender:"user",id:E,rawMessage:l},{sender:"agent",id:o,isPending:!0}]),setTimeout(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"smooth"})},5);var b=()=>K(e,{...i,isResent:!0}),I=setTimeout(()=>{f.current=null,d(e=>e.map(e=>e.id!==o?e:rV(o,b))),aA({containerElement:r.current,assistantMessageId:o,userMessageId:E}),v({threadId:n,status:"ERROR",error:"SEND_TIMEOUT"})},1e4);y({userId:i.userId,threadId:n,text:l}).then(T=>{if(clearTimeout(I),t({requestName:"addMessage",error:T.error,hasData:!!T.data}),f.current&&o===f.current){var y=T.data?.TravelChatManager_addMessage,C=y?.status,N=y?.reply,_=N?.promptMessageId,S=N?.messageId,M=N?.threadId;if(a({itemType:"aitaMessagesPanel",actionSubType:"submitMessage",threadType:void 0===n?"NEW":"EXISTING",threadId:M,messageId:_,messageType:c,messageOrigin:u,textLength:l.length,messageResent:i.isResent,promptType:h,promptScrollDepth:g,preLoginGateState:i.preLoginGateState??"LOGGED_IN"}),T.error?.networkError||!C||!N||"ANOTHER_PROMPT_PENDING"===C||!M||!S||!_){d(e=>e.map(e=>e.id!==o?e:rV(o,b))),setTimeout(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"smooth"})},5),f.current=null;var R="SEND_INVALID_RESPONSE";T.error?.networkError?R="SEND_NETWORK_ERROR":"ANOTHER_PROMPT_PENDING"===C&&(R="ANOTHER_PROMPT_PENDING"),v({threadId:M??n,messageId:S,status:"ERROR",error:R});return}M!==n&&s(M);var k={sender:"agent",id:N.messageId,responseData:{...N,__typename:"TravelChatManager_AssistantMessage"}},P="PENDING"===N.status,A=!P&&!N.content?.length||tz(N.status),w=A?rV(o,b):{...k,isPending:P};if(d(e=>e.map(e=>e.id===o?w:e.id===E?{...e,id:_}:e)),A||m([{...k,isPending:P}]),aA({containerElement:r.current,assistantMessageId:S,userMessageId:_}),f.current=P?S:null,P)p({assistantMessageId:S,userMessageId:_,userMessage:e});else{var O="SEND_EMPTY_RESPONSE";A&&("ERROR"===N.status?O="SEND_SERVER_ERROR":"TIMEOUT"===N.status?O="SEND_SERVER_TIMEOUT":T.error?.graphQLErrors&&(O="SEND_GRAPHQL_ERROR")),v({threadId:M,messageId:S,message:N.content??void 0,...A?{status:"ERROR",error:O}:{status:N.status}})}}})}},[y,n,a,v,t]);o(()=>{if(!Q){var e=setTimeout(()=>{if(g.assistantMessageId===f.current){var e=g?.userMessage,a=e?()=>K(e,{isResent:!0}):null;d(e=>e.map(e=>e.id!==g.assistantMessageId?e:rV(g.assistantMessageId,a??void 0))),aA({containerElement:r.current,assistantMessageId:g.assistantMessageId,userMessageId:g.userMessageId}),v({threadId:n,messageId:g.assistantMessageId,status:"ERROR",error:"POLL_TIMEOUT"}),p(null),f.current=null}},47e3);return()=>{clearTimeout(e)}}return()=>{}},[Q,v,n,g?.assistantMessageId,g?.userMessage,g?.userMessageId,K]),e9(()=>{if(e&&!P&&!A){k?.nextMessageId&&I({messageId:k.nextMessageId,pauseQuery:!0});var a=k?.messages?.map(e=>tx(e)).filter(Boolean)||[];k?.nextMessageId||a.unshift(aB),d(a),m(a),setTimeout(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"instant"})},0);var t=rW(a);if(t){f.current=t;var n=a[a.length-2];p({assistantMessageId:t,userMessageId:n&&"user"===n.sender?n.id:void 0,userMessage:null})}}},[e,k,P,A]),e9(()=>{if(e&&!L.fetching&&!L.error&&L.data?.messages?.length){I({messageId:L.data.nextMessageId??null,pauseQuery:!0});var a=L?.data?.messages?.map(e=>tx(e)).filter(Boolean)||[];if(L.data?.nextMessageId||a.unshift(aB),a.length){d(e=>a.concat(e)),m(a);var t=(r.current?.scrollHeight??0)-(r.current?.scrollTop??0);setTimeout(()=>{r.current&&r.current.scroll({top:(r.current?.scrollHeight??0)-t,behavior:"instant"})},0)}}},[e,L.fetching,L.error,L.data]),o(()=>{var e=null;if(!g||x||!f.current)return()=>clearTimeout(e);var a=z?.messages?.[0],t=!a||"TravelChatManager_AssistantMessage"!==a.__typename;if((H||t)&&B.current<=3)return B.current++,e=setTimeout(()=>{V({requestPolicy:"network-only"})},500),()=>clearTimeout(e);var{assistantMessageId:i,userMessage:o}=g,s=o?()=>K(o,{isResent:!0}):null;if(H?.networkError||t)return d(e=>e.map(e=>e.id!==i?e:rV(i,s??void 0))),aA({containerElement:r.current,assistantMessageId:i,userMessageId:g.userMessageId}),v({threadId:n,messageId:i,status:"ERROR",error:H?.networkError?"POLL_NETWORK_ERROR":"POLL_INVALID_RESPONSE"}),p(null),f.current=null,()=>clearTimeout(e);B.current=0;var l={id:a.messageId,sender:"agent",responseData:a},c=rV(a.messageId,s??void 0),u="PENDING"===a.status,h=!u&&!a.content?.length||tz(a.status),T=h?c:{...l,isPending:u};if(d(e=>e.map(e=>e.id===i?T:e)),h||m([{...l,isPending:u}]),aA({containerElement:r.current,assistantMessageId:i}),u)e=setTimeout(()=>{V({requestPolicy:"network-only"})},500);else{var E="POLL_EMPTY_RESPONSE";h&&("ERROR"===a.status?E="POLL_SERVER_ERROR":"TIMEOUT"===a.status?E="POLL_SERVER_TIMEOUT":H?.graphQLErrors&&(E="POLL_GRAPHQL_ERROR")),v({threadId:n,messageId:i,message:a.content??void 0,...h?{status:"ERROR",error:E}:{status:a.status}}),p(null),f.current=null}return()=>clearTimeout(e)},[n,g,z,x,H,V,v,K]);var q=c(()=>{!S&&!C&&g&&n&&(a({itemType:"aitaMessagesPanel",actionSubType:"cancelPendingMessage",threadId:n,messageId:g.assistantMessageId}),_({threadId:n,messageId:g.assistantMessageId}).then(e=>{t({requestName:"cancelPending",error:e.error,hasData:!!e.data}),e.error||(f.current=null,p(null),d(e=>e.map(e=>e.id!==g.assistantMessageId?e:{sender:"agent",isCancel:!0,id:g.assistantMessageId,isPending:!1})),aA({containerElement:r.current,assistantMessageId:g.assistantMessageId,userMessageId:g.userMessageId}),v({threadId:n,messageId:g.assistantMessageId,status:"CANCELED"}))}))},[C,S,_,n,g,a,t,v]),G=!!E.messageId,Y=c(()=>{var t=!!r.current?.scrollTop&&r.current.scrollTop<200;e&&G&&t&&E.messageId&&E.pauseQuery&&!L.fetching&&(a({actionType:"scroll",itemType:"aitaMessagesPanel",actionSubType:"pageMessages",threadId:e}),I({messageId:E.messageId,pauseQuery:!1}))},[G,E,L.fetching,a,e]),j=c(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"instant"})},[]);return{containerRef:r,fetching:P,error:A,reexcuteInitialMessagesQuery:w,reexcutePagedMessagesQuery:D,messages:l,currentThreadId:n,hasPendingMessage:!!rW(l),pagedMessagesError:L.error,addNewUserMessage:K,fetchingAddNewUserMessage:C,cancelPendingMessage:q,fetchingCancelPending:S,errorCancelPending:M,onScrollContainer:Y,scrollToBottom:j,mostRecentMessageResponse:h}},rq="UUbRM f u",rG=e=>r("svg",{...e7(e),viewBox:"0 0 7 8",children:r("path",{d:"M3.49988 0.5C3.76072 2.30875 5.1912 3.73921 7 4.00008C5.19126 4.26095 3.76078 5.69133 3.49988 7.5C3.23901 5.69137 1.80866 4.26096 0 4C1.80868 3.73903 3.23904 2.30866 3.49988 0.5Z"})}),rY=({showText:e,text:a})=>t("div",{className:"MBkjX f u",children:[t("div",{className:"fNJxz f u Cj",children:[r("div",{className:Q(rq,"bQQya"),children:r(rG,{size:7})}),r("div",{className:Q(rq,"DvZAA"),children:r(rG,{size:7})}),r("div",{className:Q(rq,"jAGBb"),children:r(rG,{size:7})})]}),e&&r(et,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",automationId:"aitaRecommendationsSearchInProgress",children:a||ad.chat.loadingInitialResponse})]}),rj={message:"mnYlg z w f e",inlineStart:"BWiSl",inlineEnd:"OARkt",header:"nBnEO",footer:"w",messageContainer:"tYEZx z Zb Re",redBackground:"cbTzG",transparentBackground:"AEDGb",greenBackground:"AvYmN",saveButtonContainer:"wgFmf _m",fullWidth:"w"},rU=({header:e,children:a,footer:n,orientation:i="inlineStart",backgroundColor:o,saveButton:s,fullWidth:l=!1,...d})=>t("li",{className:eG(rj.message,{[rj.inlineStart]:"inlineStart"===i,[rj.inlineEnd]:"inlineStart"!==i}),children:[e?r("div",{className:rj.header,children:e}):null,t("div",{className:eG(rj.messageContainer,{[rj.redBackground]:"red"===o,[rj.transparentBackground]:"transparent"===o,[rj.greenBackground]:"green"===o,[rj.fullWidth]:l}),children:[s?r("div",{className:rj.saveButtonContainer,children:s}):null,r("div",{className:ej(d),children:a})]}),n?r("div",{className:rj.footer,children:n}):null]}),rF=({message:e,isFirstUserMessage:a,userAvatar:n,agentAvatar:i,backgroundColors:o,threadId:s})=>{var{isEnabled:l}=X(),d=e.id===rx,c="user"===e.sender,u=e.contents.map((a,t)=>{var s=`${e.id}-${t}`,l=c?n:i,d=c?o.user:o.agent,u=null;return"list"!==a.type&&(u=c||e.isPending?{paddingX:"spacing-03",paddingY:"spacing-02"}:{padding:["spacing-03","spacing-03","spacing-04"]}),r(az,{fullWidth:"list"===a.type,footer:a.footer,header:0===t?l:null,orientation:c?"inlineEnd":"inlineStart",backgroundColor:a.backgroundColor??d,saveButton:a.saveButton,...u,children:a.content},s)});return t("ul",{[rw]:e.id,children:[e.isPending?r("li",{children:r(rY,{showText:a,text:e.intermediateThought})}):null,u,!l||c||d?null:r(B,{children:r(g,{children:r(ax,{threadId:s||"thread not started yet",messageId:e.id,orientation:"inlineStart"})})})]})},rZ=({prompts:e,onPromptClick:a})=>{var n=V({itemType:"aitaPrompts",arrayQuestionIds:e.map(e=>e.id??null)}),i=c((e,t)=>{a(e,t)},[a]);return 0===e.length?null:r("div",{ref:n,className:"ELIAc","aria-label":ad.chat.ariaPromptsList,role:"region",children:e.map((e,a)=>r("div",{className:"aogaM",children:r($,{variant:"gai",size:"small",onClick:()=>i(e,a),...eS("aitaDynamicPrompt"),children:t("span",{className:"f G u Wh",children:[r("span",{className:"I",children:r(e5,{size:20,marginRight:"spacing-01"})}),e.text]})})},e.text))})},rX=({hideScrollButton:e,onClick:a})=>e?null:r("div",{className:"upLEx D _s Rb Za",children:r(ee,{variant:"primary-border",size:"small",icon:eb,onClick:a,"aria-label":ad.chat.scrollDown})}),rJ="ZVkDM Cq Wb",r$=()=>{var{privacyPolicy:e,termsOfUse:a}=aa(),t=ae();return r("div",{className:"eJfmT Gm Re c",children:r(et,{atlasVariant:"fixed-body-10",color:"onSurface",children:r(eh,{id:"ai_assistant_legal_disclaimer_v3",args:{termsLinkAttributes:`href="${a}" target="_blank" class="${rJ}"`,privacyLinkAttributes:`href="${e}" target="_blank" class="${rJ}"`,howTheSiteWorksLinkAttributes:`href="${t}" target="_blank" class="${rJ}"`},messages:"AI-generated; may contain inaccuracies. Don't share personal data. See <a {termsLinkAttributes}>Terms</a>, <a {privacyLinkAttributes}>Privacy &amp; Cookies Statement</a>, and <a {howTheSiteWorksLinkAttributes}>How Ollie Works</a>."})})})},r0=e=>({content:t("div",{children:[r(rN,{}),!!e&&r("div",{children:r(ea,{onClick:e,type:"button",children:ad.chat.retrySendMessageCta})})]}),backgroundColor:"red"}),r1={__key:0xbcb404bb2efd,id:"bcb404bb2efd42c2",loc:{},definitions:[]},r2=(e,a)=>{var t=s(()=>{var a=new Set,t=new Map;return e.forEach(e=>{var r=e?.details?.locationV2?.tags?.tags?.map(e=>e?.tagId&&11066!==e.tagId?e.tagId:null)?.filter(Boolean)?.slice(0,2)||[],n=[...e?.details?.locationV2?.tags?.tags?.find(e=>e?.tagId===11066)?[11066]:[],...r];e?.details?.locationId&&(t.set(e.details.locationId,n),n.forEach(e=>a.add(e)))}),{allLocationTags:a,locationTagIdsMap:t}},[e]),[{data:r,fetching:n}]=eo({query:r1,variables:{tagIds:[...t.allLocationTags]},pause:!t.allLocationTags.size||a}),i=r?.getTagInformation;return{allLocationTagsInfoMap:s(()=>{var a=new Map;return e.forEach(e=>{if(e?.details?.locationId){var r=t.locationTagIdsMap.get(e.details.locationId)?.map(e=>{var a=i?.find(a=>a?.tagId===e);return a?{localizedName:a.localizedName,categoryId:a.categoryId,tagId:a.tagId}:null}).filter(Boolean)||[];a.set(e?.details?.locationId,r)}}),a},[e,i,t.locationTagIdsMap]),isTagInfoFetching:n}},r4=({initialThreadId:e,onSelectThread:a,initialUserMessage:l,onClose:d,onOpenThreadsPanel:c,createNewThread:u,onHasResponse:h,prompts:m})=>{var g=W(),{login:p}=K(),f=!!q(),T=J(),{openToast:v}=a5(),[E,b]=i(new Map),{containerRef:I,messages:C,mostRecentMessageResponse:N,currentThreadId:_,hasPendingMessage:S,pagedMessagesError:M,addNewUserMessage:R,fetchingAddNewUserMessage:A,cancelPendingMessage:w,fetchingCancelPending:O,errorCancelPending:L,fetching:D,error:B,reexcuteInitialMessagesQuery:Q,reexcutePagedMessagesQuery:z,onScrollContainer:x,scrollToBottom:H}=aQ({initialThreadId:e}),{allLocationTagsInfoMap:V}=r2(s(()=>tQ(N),[N]),S);return(o(()=>{C.length>2&&h?.()},[h,C]),o(()=>{S||b(e=>{var a=new Map(e);return V?.forEach((e,t)=>a.set(t,e)),a})},[V,b,S]),o(()=>{l?.text&&!D&&R(l)},[l,R,D]),o(()=>{L&&v({textContent:ad.chat.canceledMessageError,variant:"error",icon:"error"})},[v,L]),o(()=>{a(_||null)},[_,a]),D)?r(P,{onClose:d,onOpenThreadsPanel:c,createNewThread:u}):B?t(n,{children:[r(k,{onClose:d,onOpenThreadsPanel:c,createNewThread:u}),r(y,{errorBody:ad.panel.errorBody,buttonSize:"medium",retry:Q,retryButtonTitle:ad.panel.errorCta,isFullScreen:!0})]}):r(aY,{ref:I,messages:C,prompts:m,isLoading:A||O,showCancelPendingButton:S,onSubmitMessage:e=>{g({itemType:"aitaMessagesPanel",actionSubType:"clickToInitiateQuery",promptScrollDepth:e.promptScrollDepth,promptType:e.promptType,threadType:_?"EXISTING":"NEW",messageType:e.type,messageOrigin:"MESSAGES_PANEL",textLength:e.text.length}),f?R(e):p({flowOrigin:"login",extraQueryParams:{contextualMessage:"ask_ollie_login_gate_header"},onClose:()=>{g({itemType:"aitaMessagesPanel",actionSubType:"cancelLoginFlow",entryPointType:e.type,promptType:e.promptType,messageOrigin:"MESSAGES_PANEL"})},onSuccess:a=>{a.userId&&R(e,{userId:a.userId,preLoginGateState:a.hasCreatedMember?"NOT_REGISTERED":"LOGGED_OUT"})}})},onCancelPendingMessage:w,onScroll:x,onScrollToBottom:H,backgroundColors:{user:"green"},onClose:d,onOpenThreadsPanel:c,createNewThread:u,pagedMessagesError:!!M,onTryLoadMore:z,threadId:_,tagsInfoMap:E,isMapViewExperimentEnabled:T.enabled})},r3=e=>e?.TravelChatManager_getThreadHeaders?.threads?.map(e=>{if(!e)return null;var{threadId:a,updatedAt:t,title:r,active:n}=e,i=new Date(t);return!r||isNaN(i.getTime())?null:{threadId:a,updatedAt:i,title:r,active:n}}).filter(Boolean)||[],r6=({isSelected:e,threadId:a,title:n,onThreadClick:i,onDeleteThread:o})=>{var s="DESKTOP"===z();return t("div",{className:Q("smQnc z w k Ph PN Pu PA",{Tmmzm:e}),children:[r("button",{type:"button",onClick:()=>i(a),className:"rNDha H _S _G Hn B- C-","data-thread-id":a,children:r(et,{atlasVariant:"fixed-body-30",color:"onSurface",lineClamp:1,children:n})}),r("div",{className:"LBkfM",children:r(ee,{onClick:()=>o(a),variant:s?"dark":"clear",icon:ao,"aria-label":ad.threads.deleteSessionButtonAriaLabel(n),size:"small",...eS("aitaDeleteThread")})})]})},r9={threadPanel:"eIVvQ _Z f e",horizontalMargins:"NO Nm",header:"XBCOu f k",threadPanelScroll:"CULaQ MK",newChatContainer:"UcvOV",newThreadButton:"orUOn w Ph PV Pu PA f u",threadsGroup:"SxCln",threadsGroupHeader:"yUDiM t Z1",resetButtonStyles:"SUdPB _S _G Hn B- C-"},r7=({onClose:e})=>t("div",{className:Q(r9.header,r9.horizontalMargins),children:[r(et,{atlasVariant:"fixed-title-20",elementType:"h2",color:"onSurface",children:ad.threads.title}),r(ee,{onClick:e,icon:ef,"aria-label":ad.threads.closeButtonAriaLabel,size:"small",automationId:"aitaCloseThreadsPanel"})]}),r5=()=>r("div",{className:"lArbl _Q X0 X1",children:r(ey,{variant:"large"})}),r8=({selectedThreadId:e,onThreadClick:a,createNewThread:s,onClose:l,initialThreadHeadersInfo:d})=>{var h=W(),{deleteThreads:m,state:g}=tu(),p=b(),f=u(null),[T,v]=i({threadId:null,pauseQuery:!0}),[E,I]=i([]),{openToast:C}=a5(),{fetching:_,error:S,data:M,reexcuteQuery:R}=d,k=T.pauseQuery||!T.threadId,[{fetching:P,error:A,data:w},O]=tc({threadId:T.threadId??void 0,limit:30},k);N({requestName:"getThreadHeaders",fetching:P,error:A,isQueryPaused:k,hasData:!!w}),o(()=>{if(!_&&!S&&M?.TravelChatManager_getThreadHeaders){I(aU(M));var{nextThreadId:e}=M.TravelChatManager_getThreadHeaders;e&&v({threadId:e,pauseQuery:!0})}},[_,S,M]),o(()=>{if(!P&&!A&&w?.TravelChatManager_getThreadHeaders){var e=aU(w);if(e.length){I(a=>a.concat(e));var{nextThreadId:a}=w.TravelChatManager_getThreadHeaders;a&&v({threadId:a,pauseQuery:!0})}}},[P,A,w]);var L=c(()=>{if(null!==f.current){var e=f.current,a=e.scrollHeight-(e.scrollTop+e.getBoundingClientRect().height);T.threadId&&a<200&&!P&&(h({actionType:"scroll",itemType:"aitaThreadsPanel",actionSubType:"pageThreads"}),v(e=>({...e,pauseQuery:!1})))}},[T.threadId,P,h]);return _?t(n,{children:[r(r7,{onClose:l}),r(aJ,{})]}):S?t(n,{children:[r(r7,{onClose:l}),r(y,{errorBody:ad.panel.errorBody,buttonSize:"medium",retry:R,retryButtonTitle:ad.panel.errorCta,isFullScreen:!0})]}):r(aX,{ref:f,selectedThreadId:e,onScroll:L,threads:E,pagedThreadsError:!!A,onThreadClick:e=>{h({itemType:"aitaThreadsPanel",actionSubType:"openExistingThread",threadId:e}),a(e)},createNewThread:()=>{h({itemType:"aitaThreadsPanel",actionSubType:"openNewThread",lastOpenedThreadId:e}),s()},onDeleteThread:a=>{g.fetching||(h({itemType:"aitaThreadsPanel",actionSubType:"deleteThread",threadId:a}),m(a).then(t=>{p({requestName:"deleteThreads",error:t.error,hasData:!!t.data}),t.error?C({textContent:ad.threads.sessionDeletedError,variant:"error",icon:"error"}):(R(),e===a&&s(!0),C({textContent:ad.threads.sessionDeleted,variant:"primary",icon:"success",isDurationLong:!0}))}))},onTryLoadMore:O,onClose:l})},ne=({selectedThreadId:e,onThreadClick:a,createNewThread:n,onClose:i,isOpen:o,initialThreadHeadersInfo:s})=>{var{isClosed:l,slideOut:d}=A({isOpen:o,transitionDuration:250});return l?null:r(at,{children:t("div",{className:Q({vNEuT:d}),children:[r("div",{className:"suJWM _Q t s l _U Gi",onPointerDown:i}),r("div",{className:"WXoky _Q t s l _U _s o Gi",children:r(a$,{selectedThreadId:e??void 0,onThreadClick:a,createNewThread:n,onClose:i,initialThreadHeadersInfo:s})})]})})},na=()=>{var e=!q(),[{fetching:a,error:t,data:r},n]=tc({limit:45},e);return N({requestName:"getThreadHeaders",fetching:a,error:t,isQueryPaused:e,hasData:!!r}),s(()=>{var e=a||t?void 0:r?.TravelChatManager_getThreadHeaders?.threads?.find(e=>!!e?.active);return{initialThreadHeadersFetching:a,initialThreadHeadersError:t,initialThreadHeadersData:r,reexcuteInitialThreadsQuery:n,activeThread:e}},[a,t,r,n])},nt=({onSelectThread:e,onHasResponse:a,initialUserMessage:s,onClose:l,prompts:d,isPromptsLoading:c})=>{var u=W(),{login:h}=K(),m=!!q(),[g,p]=i(void 0),[f,T]=i(!0),[v,E]=i(!1),[b,I]=i(void 0),[C,N]=i(!1),{activeThread:_,initialThreadHeadersFetching:S,initialThreadHeadersError:M,initialThreadHeadersData:R,reexcuteInitialThreadsQuery:A}=a1();o(()=>{if(!S&&!C){var e;_?.threadId&&!s&&(e=_?.threadId,T(!1),p(_.threadId),I(_?.threadId?_.threadId:`TMP-KEY-PROP-${Math.random()}`)),u({actionType:"other",itemType:"aitaMessagesPanel",...void 0===e?{actionSubType:"autoOpenNewThread"}:{actionSubType:"autoOpenExistingThread",threadId:e}}),N(!0)}},[_,S,p,I,e,s,C,u]);var w=(e,a)=>{T(!1),E(a??!1),e&&e===g||(p(e),I(e||`TMP-KEY-PROP-${Math.random()}`))},O=()=>{u({itemType:"aitaMessagesPanel",actionSubType:"openNewThread",lastOpenedThreadId:g}),w()},L=e=>{u({itemType:"aitaMessagesPanel",actionSubType:"openThreadsPanel",lastOpenedThreadId:g,preLoginGateState:e}),A?.(),E(!0)},D=()=>{u({itemType:"aitaMessagesPanel",actionSubType:"clickToOpenThreadsPanel",lastOpenedThreadId:g}),m?L("LOGGED_IN"):h({flowOrigin:"login",extraQueryParams:{contextualMessage:"ask_ollie_login_gate_header"},onClose:()=>{u({itemType:"aitaMessagesPanel",actionSubType:"cancelLoginFlow",entryPointType:"OPEN_THREADS_PANEL_CTA",messageOrigin:"MESSAGES_PANEL"})},onSuccess:e=>L(e.hasCreatedMember?"NOT_REGISTERED":"LOGGED_OUT")})},B=!C||c,Q=B?r(P,{onClose:l,onOpenThreadsPanel:D,createNewThread:O}):null,z=M?t(n,{children:[r(k,{onClose:l,onOpenThreadsPanel:D,createNewThread:O}),r(y,{errorBody:ad.panel.errorBody,buttonSize:"medium",retry:A,retryButtonTitle:ad.panel.errorCta,isFullScreen:!0})]}):null;return t("div",{className:"_Q t s l _U",children:[r("div",{className:"imuyB _Z Gm",children:B||M?t(n,{children:[Q,z]}):r(aj,{initialThreadId:g??void 0,onSelectThread:e,initialUserMessage:f?s:void 0,onClose:l,onOpenThreadsPanel:D,createNewThread:O,onHasResponse:a,prompts:d},b)}),r(a0,{selectedThreadId:g,isOpen:v,onThreadClick:w,createNewThread:e=>w(void 0,e),onClose:()=>E(!1),initialThreadHeadersInfo:{fetching:S,error:!!M,data:R,reexcuteQuery:()=>A?.()}})]})},nr=e=>r(al,{children:r(nt,{...e})}),nn=({children:e})=>{var{modalRef:a,status:t}=O(),n="MOBILE"===z();return"exited"===t?null:r(x,{ref:a,role:"dialog",hideBackdrop:!n,disableBlockScroll:!n,className:Q("gPGsz Za f e o s _U",{TksLf:"exiting"===t||"enter"===t,pREmD:"entering"===t||"entered"===t||"exit"===t}),children:r("div",{className:"MEbqN f e Gi _Y o",children:e})})},ni=({isOpen:e,onClose:a,children:t})=>{var n="MOBILE"===z();return r(w,{isDragToDismissEnabled:n,isOpen:e,onClose:a,children:r(nn,{children:t})})},no={ok:"rxoX9PgJuydBH0GlcDMrIIpYuv/yL8od/wC1AyPzntY=",error:"rxoX9PgJuydBH0GlcDMrIEzlXcCmwSOXO6ZNctaReCs="},ns=({isError:e})=>(a3.useIsomorphicIncrement(1,e?no.error:no.ok),null),nl=({error:e,errorInfo:a,onCloseChat:i})=>(console.error("[AITA] Error rendering panel:",e,"\nComponent stack:",a.componentStack),t(n,{children:[t("div",{className:"_Q l _U t s",children:[r(k,{onClose:i}),r(y,{errorTitle:H.errorBoundaryTitle,errorBody:H.errorBoundaryBody,isFullScreen:!0})]}),r(ns,{isError:!0})]})),nd=e=>{var[a,t]=i(!1),r=v.useConstantIncrementCallback(1);o(()=>{!a&&e&&(r(f.sender_name,E.MEM),t(!0))},[a,e,r])},nc=({isOpen:e,onSelectThread:a,onCloseChat:n,onHasResponse:i,initialUserMessage:o,prompts:s,isPromptsLoading:l})=>{nd(e);var d=L("chat_panels");return r(a4,{isOpen:e,onClose:n,children:t(B,{onError:()=>d(),errorRenderer:(e,a)=>r(nl,{error:e,errorInfo:a,onCloseChat:n}),children:[r(a2,{onSelectThread:a,initialUserMessage:o,onClose:n,prompts:s,isPromptsLoading:l,onHasResponse:i}),r(ns,{})]})})};return[()=>{as=l({openToast(){throw Error("Missing 'openToast' in ChatPanelsToastContext")}}),al=a7,ad=Z({header:{closeButtonAriaLabel:"Minimize AI assistant"},chat:{welcomeMessage:"I'm Ollie, your AI travel companion! I scan English-language reviews, forum posts, and recommendations for wisdom that'll help your trip take flight. Some questions you can ask me:",welcomeHeading:"Hello! \uD83D\uDC4B ",canceledMessage:"Your message was canceled—I didn’t see a thing! \uD83E\uDEE3",canceledMessageError:"I couldn’t cancel that message, sorry about that.",errorMessages:["Seems like I ran into a bit of a hiccup—sorry about that! Mind asking your question again?","Oops—I got a little tangled up looking for your answer. Can you repeat it for me?","I got a little mixed up looking for your answer—sorry! Want to try again? I'm right here when you're ready.","Whelp, I think there's a problem on my end—my mistake. Can you ask your question again?","Uh oh...flew a little too fast and hit a snag on my search. Can you ask me one more time?","Whoops! Looks like I hit a bit of turbulence fetching an answer. Try asking it again."],sourcesErrorBody:"Got a little mixed up while grabbing content for you—sorry!",sourcesErrorCta:"Try again",showSources:"Show sources",showSource:"Show source",hideSources:"Hide sources",hideSource:"Hide source",seeFullForumPost:"See full forum post",loadingInitialResponse:"Hang tight while I dive into our traveler recommendations and reviews...",ariaLoadingResponse:"The AI assistant is generating a response",ariaPromptsList:"Examples of questions you can ask the AI assistant about this place",moreMessagesErrorBody:"There was a problem retrieving older messages.",moreMessagesErrorCta:"Try again",retrySendMessageCta:"Try again",map:"Map",list:"List",scrollDown:"Scroll down"},threads:{title:"Previous sessions",newThread:"Start a new session",today:"Today",yesterday:"Yesterday",lastWeek:"Last Week",lastMonth:"Last Month",older:"Older",sessionDeleted:"Session deleted. Items saved to Trips are still available.",sessionDeletedError:"Session was not deleted. Please try again.",deleteSessionButtonAriaLabel:e=>`Delete session titled ${e}`,closeButtonAriaLabel:"Close session history",moreThreadsErrorTitle:"Oops!",moreThreadsErrorBody:"There was a problem retrieving older chats.",moreThreadsErrorCta:"Try again"},panel:{errorBody:"Got a little mixed up while grabbing content for you—sorry! ",errorCta:"Let’s try that again"},feedback:{voteThumbsUpAriaLabel:"Give this response a thumbs up",voteThumbsDownAriaLabel:"Give this response a thumbs down",votedThumbsUpAriaLabel:"You gave this response a thumbs up",votedThumbsDownAriaLabel:"You gave this response a thumbs down",closeAriaLabel:"Close feedback form",thumbsDownTitle:"What was the primary issue with this response?",thanksGood:"Thanks for your feedback!",thanksBad:"Thanks. Your feedback is valuable as we continue to improve our responses.",submitButton:"Submit",inputAriaLabel:"Add your comments",feedbackPlaceholder:"Add your comments",error:"Something went wrong while submitting your feedback. Please try again.",options:{NOT_FACTUAL:"Factually incorrect",LOW_QUALITY:"Low-quality recommendation",MISSING_DETAILS:"Missing key details",REFUSE_TO_ANSWER:"Refused to respond",ERROR:"Error or bug",INAPPROPRIATE:"Inappropriate",OTHER:"Other"}}}),ac=Z([244,283,635,636]),au=f.message,ah=ad.feedback.options,am=tT,ag=tv,ap=tC,af=tN,aT=f.source,av=tS,aE=tH,ab=tq,aI=h(function({location:e,locationReviewSummary:a,onSaveClick:i,onSaveComplete:o,onNameLinkClick:s,tagsInfo:l},d){if(!e)return null;e.isGeo||a?.responseData?.rating==null||a?.responseData?.count==null||(c={rating:a.responseData.rating,reviewCount:a.responseData.count});var c,u=t(n,{children:[r("div",{className:t4.imageContainer,children:r(eW,{roundingSize:"none",action:r(ei,{id:e.locationId||void 0,variant:"primary",bookmarkStyle:"circular-button",size:"small",saveSourceOrigin:"AI_TRAVEL_ASSISTANT",onClick:i,onSaveComplete:o}),award:e.locationV2?.bestAwardForActiveYearV2?.awardType&&r(eH,{size:"small",color:e.locationV2?.bestAwardForActiveYearV2?.awardType==="BOTB"?"yellow":"green",year:e.locationV2?.bestAwardForActiveYearV2?.year??void 0}),children:r(ex,{source:e.thumbnail?.photoSizeDynamic,aspectRatio:"1:1",roundingSize:"none"})})}),t("div",{className:t4.info,children:[r(et,{lineClamp:1,atlasVariant:"fixed-title-10",color:"onSurface",children:e.name}),c?r(eM,{size:"small",showRating:!1,rating:c.rating,reviewCount:c.reviewCount}):null,r(tX,{location:e,tagsInfo:l})]})]});return r("div",{className:t4.container,ref:d,children:e.route?.url?r("a",{href:e.route?.url,target:"_blank","aria-label":e.name||void 0,className:t4.card,onClick:s,children:u}):r("div",{className:t4.card,children:u})})}),ay=h(function({index:e,threadId:a,messageId:t,location:n,locationReviewSummary:i,tagsInfo:o},s){var l=q(),d=n?.locationId,c={itemType:"aitaLocationCard",threadId:a,messageId:t,itemId:`${d}`,isBookableAttractionProduct:n?.locationV2?.details?.__typename==="LocationSelection_AttractionProductDetails"&&n?.locationV2?.details?.productDetails?.pricingInfo!=null,viewType:"MAP"},u=V({...c,saveable:!0}),h=W();return r("div",{ref:u,children:r(aI,{ref:s,location:n,locationReviewSummary:i,onSaveClick:()=>{h({...c,actionSubType:"clickSaveButton"})},onSaveComplete:(e,a,t)=>{h({...c,actionSubType:"saveLocationToTrip",tripId:t,tripSaveType:a}),_(l)},onNameLinkClick:()=>h({...c,actionSubType:"openLocationDetails",mapScrollDepth:e}),tagsInfo:o})})}),aC=t6,aN=t9,a_=m(ra),aS=Z({top:50,bottom:200,left:50,right:50}),aM=rn,aR=rp,ak=rf,aP=rv,aA=rL,aw=new D({counterName:"aita_settled_assistant_messages",metricName:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMsBjIrNTP4r5BEJAs0VsuLUnNcQdwhjILfFMlgHmuM58+xn2VyWCLzsaeHqyRe7Wc=",version:0,additionalLabels:["EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPxmZLu0jLhWLMWnbfGiORfzkrzP74zL0vyAgCO1NCdfQ9Tc475vtE/NazR07eMROg="],labelHooks:[]},{status:["SEND_NETWORK_ERROR","SEND_INVALID_RESPONSE","SEND_EMPTY_RESPONSE","SEND_GRAPHQL_ERROR","SEND_TIMEOUT","SEND_SERVER_ERROR","SEND_SERVER_TIMEOUT","ANOTHER_PROMPT_PENDING","INAPPROPRIATE_PROMPT","CANCELED","POLL_NETWORK_ERROR","POLL_INVALID_RESPONSE","POLL_EMPTY_RESPONSE","POLL_GRAPHQL_ERROR","POLL_TIMEOUT","POLL_SERVER_ERROR","POLL_SERVER_TIMEOUT","COMPLETE"],hasLatency:["yes","no"],package:["@ta/ai-travel-assistant.panel"]}),aO=new D({counterName:"aita_settled_assistant_messages_latency",metricName:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfM4geQOE77ZFE1XgCknxHf/ttXQE9ORcW8cCRbpzdoLKg==",version:0,additionalLabels:["EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfM6bgh9aLdhPHrXgfSxTCnyNHKqS+laxZiJHQ+fz7KkbtoiqUiHsobyFt0F4GGVwUY="],labelHooks:[]},{status:["SEND_NETWORK_ERROR","SEND_INVALID_RESPONSE","SEND_EMPTY_RESPONSE","SEND_GRAPHQL_ERROR","SEND_TIMEOUT","SEND_SERVER_ERROR","SEND_SERVER_TIMEOUT","ANOTHER_PROMPT_PENDING","INAPPROPRIATE_PROMPT","CANCELED","POLL_NETWORK_ERROR","POLL_INVALID_RESPONSE","POLL_EMPTY_RESPONSE","POLL_GRAPHQL_ERROR","POLL_TIMEOUT","POLL_SERVER_ERROR","POLL_SERVER_TIMEOUT","COMPLETE"],package:["@ta/ai-travel-assistant.panel"]}),aL=Z({CANCELED:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNuYgVFD0vwpxNxBDvY9JjqCdfZmHIBk+Qz4C5Fu2JTGw==",COMPLETE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMZ+Fb2B+qz943QVCT0feyX1qVrYhs/lUMOfI/ZmwWjnw==",INAPPROPRIATE_PROMPT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPF9kphaQ2wKDwGam8WBKicetTQLjYaS7Ltak5oTLJsjg==",SEND_NETWORK_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPo7QTLDkC22NMQGm2arByZiiXF3XtuyW9BNIwXNEQ1GQ==",SEND_INVALID_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMzknTUORgKNkFSVmA6be/YFI0N7D+zPmtfJPKWa4hQEg==",SEND_EMPTY_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMi06pJTRiUVdgwYjN/sN0BUCkhOqpDA7pQchPwg5cACw==",SEND_GRAPHQL_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNnpm1u4F02i9/fwjPgOsWTrXJy0rYWmMpQUFNyRPuhCw==",SEND_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfOi896zijPg/tNKbH4v/RhJCyzRIW3cdIow+FSrtA8oCA==",SEND_SERVER_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfN9q+OhE5qVNNRyt100X4yhLolrAOkQn7iJn0YK4NAWAQ==",SEND_SERVER_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfN9q+OhE5qVNNRyt100X4yhBxY7WEVbmf0z71v1hxpiPA==",ANOTHER_PROMPT_PENDING:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPCNTYWzirITkmR00fIFh8v47k5I2pkTncKM0HIR+Jo3A==",POLL_NETWORK_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPcdCrH+GupkAHMNsjCyXBRA7zpHa/gA9ik0vKzgqC7bw==",POLL_INVALID_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfM24HZ9ETPTckzdVak33nyQ/ZT3+ceVjS1HRh8YDyt89A==",POLL_EMPTY_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMZ/6A8nFeV9BPOoIPNgWPqa89mwmzWpAWSz9MjVpvOZw==",POLL_GRAPHQL_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPrBsP7gR51bjvFez96bwzPXtldXAO4FMaefz9Buci3Nw==",POLL_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMF08RXxUirJCKe4d6fGA/CXewAUHaucWsw87k4hPvBlA==",POLL_SERVER_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMpIt6xP7u2l2WK4BBvM0AbcFLJRGIGm724NhrrISOQhg==",POLL_SERVER_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMpIt6xP7u2l2WK4BBvM0AbfcFYtgWu+llpAvt1FkXjhw=="}),aD=rz,aB=Z({sender:"agent",id:rx,rawHeading:ad.chat.welcomeHeading,rawMessage:ad.chat.welcomeMessage}),aQ=rK,az=rU,ax=p(()=>a("kvprgm")),aH=rF,aW=rZ,aV=rX,aK=h(function({onScroll:e,onScrollToBottomClick:a,children:n},o){var[s,l]=i(!0),d=c(a=>{a?.currentTarget?.scrollHeight-a?.currentTarget?.offsetHeight-a?.currentTarget?.scrollTop<=20?l(!0):l(!1),e?.()},[e]);return t("div",{className:"zexsO _T Gm z _g",ref:o,onScroll:d,children:[n,r(aV,{onClick:a,hideScrollButton:s})]})}),aq=h(function({prompts:e,onSubmitMessage:a,isLoading:n,showCancelPendingButton:s,onCancelPendingMessage:l,onScroll:d,onScrollToBottom:h,isNewConversation:m,children:g},p){var f=z(),T=u(null),v=function(e){var a=u(null),t=u(!1),{os:r}=e8(),n="IOS"===r.family;return o(()=>{var r,i,o=e.current,s=a.current;if(n&&o&&s){var l=e=>{if(!t.current&&window.visualViewport){e.preventDefault(),t.current=!0,s.focus({preventScroll:!0});var a=()=>{window.visualViewport&&window.innerHeight-window.visualViewport.height>100&&(r&&(clearTimeout(r),r=void 0),window.visualViewport?.removeEventListener("resize",a),i=void 0,o.focus({preventScroll:!0}),t.current=!1)};i=a,window.visualViewport?.addEventListener("resize",a),r=setTimeout(()=>{i&&(window.visualViewport?.removeEventListener("resize",i),i=void 0),o.focus({preventScroll:!0}),t.current=!1,r=void 0},500)}};return o.addEventListener("focus",l,!0),()=>{o.removeEventListener("focus",l,!0),r&&clearTimeout(r),i&&window.visualViewport?.removeEventListener("resize",i),t.current&&(t.current=!1)}}},[e,n]),a}(T),[E,b]=i(!1),I=c((e,t)=>{a({text:e.text,type:"PROMPT",origin:"MESSAGES_PANEL",promptType:e.type,promptScrollDepth:t})},[a]),y=c(()=>{if(T.current){var e=parseInt(getComputedStyle(T.current).lineHeight.replace("px",""),10),a=("MOBILE"===f?6:3)*e;T.current.style.height="0px";var{scrollHeight:t}=T.current;T.current.style.height=`${Math.min(0===t?e:t,a)}px`,b(t>e)}},[f]),C=c(()=>{h?.(),"DESKTOP"===f&&T?.current?.focus()},[h,f]);return t("div",{className:"LyyTR",children:[r("textarea",{ref:v,tabIndex:-1,"aria-hidden":"true",className:"XGwZj t l Y S"}),r(aK,{ref:p,onScroll:d,onScrollToBottomClick:C,children:t("div",{className:"GWZcH e",children:[g,m&&r(aW,{prompts:e,onPromptClick:I})]})}),r("div",{className:"TvjzB s l w",children:r("div",{className:"FRJtu Pj PX Pw PJ",children:"MOBILE"===f?r(M,{ref:T,onSubmitMessage:e=>a({text:e,type:"FREE_TEXT",origin:"MESSAGES_PANEL"}),isLoading:n,showCancelPendingButton:s,onCancelPendingMessage:l,updateInputSize:y,inputHasMultipleLines:E}):r(R,{ref:T,autoFocus:"DESKTOP"===f,onSubmitMessage:e=>a({text:e,type:"FREE_TEXT",origin:"MESSAGES_PANEL"}),isLoading:n,showCancelPendingButton:s,onCancelPendingMessage:l,updateInputSize:y,inputHasMultipleLines:E})})})]})}),aG=r$,aY=h(function({messages:e,prompts:a,userAvatar:i,agentAvatar:o,onSubmitMessage:l,isLoading:d,showCancelPendingButton:c,onCancelPendingMessage:u,onScroll:h,onScrollToBottom:m,backgroundColors:g,onClose:p,onOpenThreadsPanel:f,createNewThread:T,pagedMessagesError:v,onTryLoadMore:E,threadId:b,tagsInfoMap:I,isMapViewExperimentEnabled:C},N){var _=s(()=>1===e.filter(e=>"user"===e.sender).length,[e]),S=s(()=>e.every(e=>"user"!==e.sender),[e]),M=s(()=>e.map(e=>{var a,i=[];if("user"===e.sender){var o=e?.responseData?.__typename==="TravelChatManager_UserMessage"?e.responseData.messageContent?.text:null,s=e.rawMessage??o;s&&i.push({type:"text",content:r(rI,{children:s})})}else{var l=[];if(e?.responseData?.__typename==="TravelChatManager_AssistantMessage"){var d=rP({threadId:e.responseData.threadId,messageId:e.responseData.messageId,status:e.responseData.status,content:e.responseData.content,resolvedGeoIds:e.responseData.resolvedGeoIds,feedbackRating:e.responseData.feedbackRating,isMapViewEnabled:C,tagsInfoMap:I});l=d.contents?[...d.contents]:l,a=e.responseData.intermediateThought??void 0}else e.isError?l.push(r0(e.refetch)):e.isCancel?l.push({content:r(ry,{})}):e.rawMessage&&l.push({content:t(n,{children:[e.rawHeading?r(et,{atlasVariant:"fixed-label-30",children:e.rawHeading}):null,r(rI,{children:e.rawMessage})]})});i.push(...l)}return{id:e.id,sender:e.sender,isPending:e.isPending,intermediateThought:a,contents:i}}),[I,e,C]);return t(aq,{ref:N,prompts:a,onSubmitMessage:l,isLoading:d,showCancelPendingButton:c,onCancelPendingMessage:u,onScroll:h,onScrollToBottom:m,isNewConversation:S,children:[r(k,{onClose:p,onOpenThreadsPanel:f,createNewThread:T}),r(aG,{}),v&&r(y,{errorBody:ad.chat.moreMessagesErrorBody,retry:E,retryButtonTitle:ad.chat.moreMessagesErrorCta}),M.map(e=>r(aH,{isFirstUserMessage:_,message:e,userAvatar:i,agentAvatar:o,backgroundColors:g,threadId:b},e.id))]})}),aj=r4,aU=r3,aF=r6,aZ=Z({today:ad.threads.today,yesterday:ad.threads.yesterday,lastWeek:ad.threads.lastWeek,lastMonth:ad.threads.lastMonth,older:ad.threads.older}),aX=h(function({selectedThreadId:e,threads:a,pagedThreadsError:n,onThreadClick:i,createNewThread:l,onDeleteThread:d,onTryLoadMore:c,onScroll:h,onClose:m},g){var p=u(null);o(()=>{p.current?.focus()},[]);var f=an(),T=s(()=>{var e=ai(f,-1),t=ai(e,-5),r=ai(t,-23),n={today:[],yesterday:[],lastWeek:[],lastMonth:[],older:[]};return a.forEach(a=>{a.updatedAt>=f?n.today.push(a):a.updatedAt>=e?n.yesterday.push(a):a.updatedAt>=t?n.lastWeek.push(a):a.updatedAt>=r?n.lastMonth.push(a):n.older.push(a)}),n},[a,f]);return t("div",{className:r9.threadPanel,children:[r(r7,{onClose:m}),r("div",{className:Q(r9.newChatContainer,r9.horizontalMargins),children:t("button",{ref:p,onClick:l,type:"button",className:Q(r9.resetButtonStyles,r9.newThreadButton),...eS("aitaStartNewSession"),children:[r(ar,{size:24}),r(et,{elementType:"span",atlasVariant:"fixed-label-30",children:ad.threads.newThread})]})}),t("div",{className:Q(r9.threadPanelScroll,r9.horizontalMargins),ref:g,onScroll:h,children:[Object.keys(aZ).map(a=>T[a].length>0&&t("div",{className:r9.threadsGroup,...eS("aitaHistoryCategory"),children:[t("div",{className:r9.threadsGroupHeader,children:[r(et,{atlasVariant:"fixed-label-30",color:"onSurfaceVariant",elementType:"h3",children:aZ[a]}),r("div",{"aria-hidden":!0,children:r(e3,{marginTop:"spacing-01",marginBottom:"spacing-01"})})]}),T[a].map(a=>r(aF,{isSelected:a.threadId===e,threadId:a.threadId,title:a.title,onThreadClick:i,onDeleteThread:d},a.threadId))]},a)),n&&r(y,{errorTitle:ad.threads.moreThreadsErrorTitle,errorBody:ad.threads.moreThreadsErrorBody,retry:c,retryButtonTitle:ad.threads.moreThreadsErrorCta})]})]})}),aJ=r5,a$=r8,a0=ne,a1=na,a2=nr,a4=ni,a3=new D({counterName:"aita_chat_render",metricName:"rxoX9PgJuydBH0GlcDMrIE0ckPAO4PpNcR5whsCgLQna55TmUC4wfTJxG+Emd/iX",version:0,additionalLabels:["rxoX9PgJuydBH0GlcDMrIHxogDvZKDvO95C6YghmCcg/uDcEH+oqiAmDB4bX4U1QKdikDf5Bk57zyePqncirRQ=="],labelHooks:[]},{status:["ok","error"],package:["@ta/ai-travel-assistant.entrypoint"]}),e("default",nc)},[e=>(t=e.jsxs,r=e.jsx,n=e.Fragment),e=>(i=e.useState,o=e.useEffect,s=e.useMemo,l=e.createContext,d=e.useContext,c=e.useCallback,u=e.useRef,h=e.forwardRef,m=e.memo,g=e.Suspense,p=e.lazy),e=>(f=e.StasisRequestCounterComponent,T=e.usePageContext,v=e.StasisRequestCounter,E=e.StasisService,b=e.useConstantIncrementGraphqlRequestCounterCallback,I=e.useHorizontalScrollButtonsState,y=e.PanelErrorUI,C=e.ChatHorizontalScrollButtons,N=e.useIsomorphicGraphqlRequestCounter,_=e.onUserSaveToTripViaAiAssistant,S=e.ErrorBoundaryCounter,M=e.BottomSheetChatInput,R=e.ChatInputControlled,k=e.MessagesPanelHeader,P=e.LoadingMessagesPanel,A=e.useModalVisibility,w=e.ChatModalProvider,O=e.useChatModal,L=e.useErrorCounter),e=>(D=e.Counter,B=e.ErrorBoundary),e=>Q=e.default,e=>z=e.useViewportCategory,e=>x=e.ModalBase,e=>H=e.C,e=>(W=e.useAitaInteractionLogger,V=e.useAitaImpressionLoggerRef),e=>K=e.default,e=>q=e.useUserId,e=>G=e.default,e=>Y=e.default,e=>j=e.default,e=>U=e.default,e=>F=e.ToastItem,e=>Z=e.readOnly,e=>(X=e.useAlphaExperiment,J=e.useMapViewExperiment),e=>($=e.default,ee=e.CircularButton,ea=e.ButtonBorderless),e=>et=e.default,e=>er=e.default,e=>en=e.default,e=>ei=e.default,e=>(eo=e.useQuery,es=e.useMutation),e=>(el=e.default,ed=e.useCurrency,ec=e.useIntlFormatter,eu=e.useRtl,eh=e.UnsafeLocalize,em=e.useLocalize),e=>eg=e.default,e=>ep=e.default,e=>ef=e.default,e=>(eT=e.RadioGroup,ev=e.RadioButton),e=>eE=e.TextArea,e=>eb=e.default,e=>eI=e.default,e=>ey=e.Spinner,e=>eC=e.default,e=>eN=e.default,e=>e_=e.default,e=>eS=e.getQAAttributes,e=>eM=e.BubbleRating,e=>eR=e.default,e=>ek=e.default,e=>eP=e.default,e=>(eA=e.LatLng,ew=e.LatLngBounds,eO=e.Util),e=>(eL=e.useMarkerRegistryContext,eD=e.CollapsibleIconPinMarker,eB=e.MarkerRegistryContextProvider),e=>eQ=e.MapComponent,e=>ez=e.debounce,e=>ex=e.default,e=>eH=e.default,e=>eW=e.CardMedia,e=>eV=e.default,e=>eK=e.IconDetail,e=>eq=e.default,e=>(eG=e.default,eY=e.lineClamp,ej=e.padding),e=>eU=e.default,e=>eF=e.getPrimaryTag,e=>eZ=e.default,e=>eX=e.default,e=>eJ=e.default,e=>e$=e.useInvalidatableQuery,e=>e0=e.default,e=>e1=e.default,e=>e2=e.default,e=>e4=e.default,e=>e3=e.default,e=>e6=e.Skeleton,e=>e9=e.useClientSideLayoutEffect,e=>e7=e.useIconSvgAttributes,e=>e5=e.default,e=>e8=e.useUserAgent,e=>ae=e.useGetServiceLink,e=>aa=e.default,e=>at=e.FocusTrap,e=>ar=e.default,e=>(an=e.useToday,ai=e.addDays),e=>ao=e.default]]},["21h32l","o4yt4q","1rki99","83pm0d","fkji80","ys6v1o","uzmmz7","c6w8qp","meqo19","rdycz1","52far5","kq4q2w","gcjubj","w43m8k","u47wjb","nntg4s","5vmpsm","22xnaq","jppfwt","essqvy","y9enps","lr6tb6","dpzonz","mqwhqn","7thqz4","n4zdla","wehxiu","qkjm8h","frf6ac","tv5det","i0z8n1","4ilds0","qndsds","633gr8","u3wokd","kt39pq","j77a03","trf9tg","0wbf8p","6h4i0r","us1vwl","jgmezl","49c7br","5xqg72","dsbyen","34bu7w","p9ucm8","f1x7n0","bp96i9","70j2tf","o3mm96","gw8uw6","p3y1zq","xfufl0","ph948p","a6i9w3","6qmqhw","fbuhsy","9zpurr","xp34yw","o80y56","dcz41w","covaqn","voa3hw","mb2nze","q213pt","h9085v","nnprhg","epp8eq","ypf49l","2r4qug","ti102j","kb5au4","d3i8k1"]]);
